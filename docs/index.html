<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AlphaGBM Architecture Visualization</title>
<style>
:root{--bg:#0a0a0f;--bg2:#12121a;--bg3:#1a1a26;--bg4:#222233;--text:#e0e0ee;--text2:#9999aa;--teal:#0d9b97;--teal2:#10b5b0;--green:#10b981;--red:#ef4444;--blue:#3b82f6;--purple:#8b5cf6;--orange:#f59e0b;--pink:#ec4899;--border:#2a2a3a;--card:#16161f;--shadow:0 4px 24px rgba(0,0,0,.4)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden}
a{color:var(--teal);text-decoration:none}
/* Header */
.header{background:var(--bg2);border-bottom:1px solid var(--border);padding:16px 32px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
.logo{font-size:22px;font-weight:700;color:var(--teal);letter-spacing:1px}
.logo span{color:var(--text2);font-size:13px;font-weight:400;margin-left:12px}
.search-box{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:8px 16px;color:var(--text);width:300px;font-size:14px;outline:none;transition:border .2s}
.search-box:focus{border-color:var(--teal)}
/* Tabs */
.tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border);padding:0 32px;overflow-x:auto;scrollbar-width:none}
.tabs::-webkit-scrollbar{display:none}
.tab{padding:14px 24px;cursor:pointer;color:var(--text2);font-size:14px;font-weight:500;border-bottom:2px solid transparent;white-space:nowrap;transition:all .2s}
.tab:hover{color:var(--text)}
.tab.active{color:var(--teal);border-bottom-color:var(--teal)}
/* Main */
.main{max-width:1400px;margin:0 auto;padding:32px}
.panel{display:none}
.panel.active{display:block;animation:fadeIn .3s}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
/* Cards */
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin:24px 0}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px;transition:all .25s}
.card:hover{border-color:var(--teal);transform:translateY(-2px);box-shadow:var(--shadow)}
.card-icon{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:16px}
.card h3{font-size:16px;margin-bottom:8px}
.card p{font-size:13px;color:var(--text2)}
.card .tag{display:inline-block;font-size:11px;padding:2px 8px;border-radius:4px;margin:2px;background:var(--bg3)}
/* Section */
.section{margin:32px 0}
.section-title{font-size:20px;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.section-title::before{content:'';width:4px;height:24px;background:var(--teal);border-radius:2px}
/* Flow diagram */
.flow{display:flex;flex-wrap:wrap;gap:0;align-items:flex-start;justify-content:center;margin:24px 0;position:relative}
.flow-node{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 20px;min-width:160px;max-width:220px;cursor:pointer;transition:all .25s;position:relative;text-align:center}
.flow-node:hover{border-color:var(--teal);box-shadow:0 0 20px rgba(13,155,151,.15)}
.flow-node.expanded{border-color:var(--teal);box-shadow:0 0 20px rgba(13,155,151,.2)}
.flow-node h4{font-size:13px;font-weight:600;margin-bottom:4px}
.flow-node p{font-size:11px;color:var(--text2)}
.flow-node .detail{display:none;margin-top:12px;text-align:left;font-size:11px;background:var(--bg3);border-radius:6px;padding:10px;color:var(--text2)}
.flow-node.expanded .detail{display:block;animation:fadeIn .2s}
.flow-node .detail code{color:var(--teal);font-size:10px;word-break:break-all}
.flow-arrow{display:flex;align-items:center;justify-content:center;width:40px;color:var(--teal);font-size:20px;flex-shrink:0}
/* Vertical flow */
.vflow{display:flex;flex-direction:column;align-items:center;gap:0;margin:24px auto;max-width:800px}
.vflow .flow-node{width:100%;max-width:600px}
.vflow .flow-arrow{width:auto;height:32px;transform:rotate(90deg)}
/* Pipeline */
.pipeline{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin:20px 0}
.pipe-step{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:12px 16px;font-size:12px;cursor:pointer;transition:all .2s;position:relative;min-width:120px;text-align:center}
.pipe-step:hover,.pipe-step.active{background:var(--card);border-color:var(--teal);color:var(--teal)}
.pipe-step .step-num{display:block;font-size:10px;color:var(--text2);margin-bottom:4px}
.pipe-step .step-detail{display:none;position:absolute;top:100%;left:50%;transform:translateX(-50%);background:var(--bg2);border:1px solid var(--teal);border-radius:8px;padding:14px;width:300px;z-index:50;margin-top:8px;text-align:left;font-size:11px;color:var(--text2);box-shadow:var(--shadow)}
.pipe-step.active .step-detail{display:block;animation:fadeIn .2s}
.pipe-step .step-detail code{color:var(--teal);font-size:10px;display:block;margin:4px 0}
/* Tables */
.tbl{width:100%;border-collapse:collapse;font-size:13px;margin:16px 0}
.tbl th{background:var(--bg3);padding:10px 14px;text-align:left;font-weight:600;color:var(--text2);font-size:12px;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border)}
.tbl td{padding:10px 14px;border-bottom:1px solid var(--border)}
.tbl tr:hover td{background:var(--bg3)}
.tbl .method{font-size:11px;font-weight:700;padding:2px 8px;border-radius:4px}
.tbl .get{background:#10b98120;color:#10b981}
.tbl .post{background:#3b82f620;color:#3b82f6}
.tbl .put{background:#f59e0b20;color:#f59e0b}
.tbl .delete{background:#ef444420;color:#ef4444}
/* Stats */
.stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px;margin:24px 0}
.stat{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:20px;text-align:center}
.stat .num{font-size:32px;font-weight:700;color:var(--teal)}
.stat .label{font-size:12px;color:var(--text2);margin-top:4px}
/* Tree */
.tree{font-size:13px;margin:16px 0}
.tree-item{padding:4px 0 4px 20px;cursor:pointer;position:relative}
.tree-item::before{content:'';position:absolute;left:6px;top:0;bottom:0;width:1px;background:var(--border)}
.tree-item::after{content:'';position:absolute;left:6px;top:14px;width:10px;height:1px;background:var(--border)}
.tree-item:hover{color:var(--teal)}
.tree-item .icon{margin-right:6px}
.tree-toggle{cursor:pointer;padding:4px 0;font-weight:600;color:var(--text)}
.tree-toggle::before{content:'â–¶';display:inline-block;width:16px;font-size:10px;transition:transform .2s}
.tree-toggle.open::before{transform:rotate(90deg)}
.tree-children{display:none;padding-left:16px}
.tree-toggle.open+.tree-children{display:block}
/* Color dots */
.dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px}
.dot-green{background:var(--green)}
.dot-blue{background:var(--blue)}
.dot-orange{background:var(--orange)}
.dot-purple{background:var(--purple)}
.dot-red{background:var(--red)}
.dot-teal{background:var(--teal)}
.dot-pink{background:var(--pink)}
/* Badges */
.badge{display:inline-block;font-size:10px;padding:2px 8px;border-radius:4px;font-weight:600}
.badge-green{background:#10b98120;color:#10b981}
.badge-blue{background:#3b82f620;color:#3b82f6}
.badge-orange{background:#f59e0b20;color:#f59e0b}
.badge-purple{background:#8b5cf620;color:#8b5cf6}
.badge-red{background:#ef444420;color:#ef4444}
.badge-teal{background:#0d9b9720;color:#0d9b97}
/* Arch diagram */
.arch{display:flex;flex-direction:column;gap:24px;margin:24px 0;align-items:center}
.arch-layer{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;padding:20px;border:1px dashed var(--border);border-radius:12px;width:100%;max-width:1000px;position:relative}
.arch-layer .layer-label{position:absolute;top:-12px;left:20px;background:var(--bg);padding:0 10px;font-size:12px;font-weight:600;color:var(--teal)}
.arch-item{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:12px 18px;font-size:12px;cursor:pointer;transition:all .2s;text-align:center;min-width:120px}
.arch-item:hover{border-color:var(--teal);transform:translateY(-2px)}
.arch-connector{width:2px;height:20px;background:var(--teal);margin:0 auto;position:relative}
.arch-connector::after{content:'â–¼';position:absolute;bottom:-8px;left:-4px;color:var(--teal);font-size:10px}
/* Collapsible */
.collapse-header{cursor:pointer;padding:12px 16px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;display:flex;justify-content:space-between;align-items:center;transition:all .2s;margin:8px 0}
.collapse-header:hover{border-color:var(--teal)}
.collapse-header::after{content:'â–¼';font-size:10px;color:var(--text2);transition:transform .2s}
.collapse-header.open::after{transform:rotate(180deg)}
.collapse-body{display:none;padding:16px;border:1px solid var(--border);border-top:none;border-radius:0 0 8px 8px;margin-top:-9px;background:var(--card)}
.collapse-header.open+.collapse-body{display:block;animation:fadeIn .2s}
/* Highlight for search */
.highlight{background:rgba(13,155,151,.3);border-radius:2px;padding:0 2px}
/* Provider cards */
.provider-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:20px;position:relative;overflow:hidden}
.provider-card .priority{position:absolute;top:0;right:0;padding:4px 12px;font-size:10px;font-weight:700;border-radius:0 10px 0 8px}
.provider-card h4{margin-bottom:8px}
.provider-card ul{list-style:none;font-size:12px;color:var(--text2)}
.provider-card li{padding:3px 0}
.provider-card li::before{content:'â€¢';color:var(--teal);margin-right:8px}
/* Score bars */
.score-bar{height:6px;background:var(--bg3);border-radius:3px;overflow:hidden;margin:4px 0}
.score-bar .fill{height:100%;border-radius:3px;transition:width .5s}
/* Wizard steps */
.wizard{display:flex;align-items:center;justify-content:center;gap:0;margin:24px 0;flex-wrap:wrap}
.wizard-step{display:flex;align-items:center;gap:0}
.wizard-dot{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;border:2px solid var(--border);color:var(--text2);cursor:pointer;transition:all .2s}
.wizard-dot:hover,.wizard-dot.active{border-color:var(--teal);color:var(--teal);background:rgba(13,155,151,.1)}
.wizard-line{width:50px;height:2px;background:var(--border)}
.wizard-label{font-size:10px;color:var(--text2);text-align:center;width:80px;margin-top:6px}
.wizard-col{display:flex;flex-direction:column;align-items:center}
/* Responsive */
@media(max-width:768px){.main{padding:16px}.cards{grid-template-columns:1fr}.flow{flex-direction:column;align-items:center}.flow-arrow{transform:rotate(90deg);height:24px;width:auto}.tabs{padding:0 8px}.tab{padding:10px 14px;font-size:13px}}
</style>
</head>
<body>

<div class="header">
  <div class="logo">AlphaGBM <span>Architecture Visualization v3</span></div>
  <input type="text" class="search-box" id="searchBox" placeholder="æœç´¢ç»„ä»¶ã€æ¥å£ã€æ–‡ä»¶... (Ctrl+K)" />
</div>

<div class="tabs" id="tabBar">
  <div class="tab active" data-tab="overview">ç³»ç»Ÿæ€»è§ˆ</div>
  <div class="tab" data-tab="stock">è‚¡ç¥¨åˆ†ææµç¨‹</div>
  <div class="tab" data-tab="options">æœŸæƒåˆ†ææµç¨‹</div>
  <div class="tab" data-tab="datasource">æ•°æ®æºä¸æ¥å£</div>
  <div class="tab" data-tab="frontend">å‰ç«¯æ¶æ„</div>
  <div class="tab" data-tab="backend">åç«¯æ¶æ„</div>
</div>

<!-- ===================== TAB 1: OVERVIEW ===================== -->
<div class="main">
<div class="panel active" id="panel-overview">

<div class="section">
  <div class="section-title">æŠ€æœ¯æ ˆ Tech Stack</div>
  <div class="cards">
    <div class="card" style="border-top:3px solid var(--green)">
      <div class="card-icon" style="background:#10b98120">âš›ï¸</div>
      <h3>Frontend å‰ç«¯</h3>
      <p>React 19 + TypeScript 5.9 + Vite 7</p>
      <div style="margin-top:10px">
        <span class="tag">React Router 7</span><span class="tag">Tailwind CSS</span><span class="tag">Radix UI</span><span class="tag">Chart.js</span><span class="tag">Lightweight Charts</span><span class="tag">i18next</span><span class="tag">Supabase Auth</span><span class="tag">Axios</span>
      </div>
    </div>
    <div class="card" style="border-top:3px solid var(--blue)">
      <div class="card-icon" style="background:#3b82f620">ğŸ</div>
      <h3>Backend åç«¯</h3>
      <p>Flask 3.0 + Python 3.13 + SQLAlchemy</p>
      <div style="margin-top:10px">
        <span class="tag">Flask Blueprints</span><span class="tag">JWT Auth</span><span class="tag">APScheduler</span><span class="tag">Gunicorn</span><span class="tag">Pydantic</span><span class="tag">Pandas</span><span class="tag">SciPy</span>
      </div>
    </div>
    <div class="card" style="border-top:3px solid var(--purple)">
      <div class="card-icon" style="background:#8b5cf620">ğŸ—„ï¸</div>
      <h3>Database æ•°æ®åº“</h3>
      <p>Supabase PostgreSQL (Prod) / SQLite (Dev)</p>
      <div style="margin-top:10px">
        <span class="tag">Connection Pool 10+20</span><span class="tag">15+ Models</span><span class="tag">Daily Cache</span><span class="tag">Keepalive</span>
      </div>
    </div>
    <div class="card" style="border-top:3px solid var(--orange)">
      <div class="card-icon" style="background:#f59e0b20">ğŸŒ</div>
      <h3>External APIs å¤–éƒ¨æ•°æ®</h3>
      <p>5 Data Providers + AI + Payment</p>
      <div style="margin-top:10px">
        <span class="tag">Yahoo Finance</span><span class="tag">Tiger API</span><span class="tag">Tushare</span><span class="tag">Alpha Vantage</span><span class="tag">Google Gemini</span><span class="tag">Stripe</span>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">é¡¹ç›®ç»Ÿè®¡ Project Stats</div>
  <div class="stats">
    <div class="stat"><div class="num">68</div><div class="label">TypeScript æ–‡ä»¶</div></div>
    <div class="stat"><div class="num">93</div><div class="label">Python æ–‡ä»¶</div></div>
    <div class="stat"><div class="num">12</div><div class="label">API Blueprints</div></div>
    <div class="stat"><div class="num">40+</div><div class="label">API Endpoints</div></div>
    <div class="stat"><div class="num">9</div><div class="label">å‰ç«¯é¡µé¢</div></div>
    <div class="stat"><div class="num">40+</div><div class="label">React ç»„ä»¶</div></div>
    <div class="stat"><div class="num">18+</div><div class="label">Service æ¨¡å—</div></div>
    <div class="stat"><div class="num">5</div><div class="label">æ•°æ®æº Providers</div></div>
  </div>
</div>

<div class="section">
  <div class="section-title">ç³»ç»Ÿæ¶æ„ System Architecture</div>
  <div class="arch">
    <div class="arch-layer" style="border-color:#10b981">
      <span class="layer-label" style="color:#10b981">ğŸ–¥ï¸ Frontend (React + Vite)</span>
      <div class="arch-item" onclick="switchTab('frontend')">Pages<br><small style="color:var(--text2)">9ä¸ªé¡µé¢</small></div>
      <div class="arch-item" onclick="switchTab('frontend')">Components<br><small style="color:var(--text2)">40+ç»„ä»¶</small></div>
      <div class="arch-item" onclick="switchTab('frontend')">Hooks<br><small style="color:var(--text2)">3ä¸ªè‡ªå®šä¹‰Hook</small></div>
      <div class="arch-item" onclick="switchTab('frontend')">Lib/Utils<br><small style="color:var(--text2)">7ä¸ªå·¥å…·æ¨¡å—</small></div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:#3b82f6">
      <span class="layer-label" style="color:#3b82f6">ğŸ”Œ API Layer (Flask Blueprints)</span>
      <div class="arch-item" onclick="switchTab('datasource')">Stock API</div>
      <div class="arch-item" onclick="switchTab('datasource')">Options API</div>
      <div class="arch-item" onclick="switchTab('datasource')">Portfolio API</div>
      <div class="arch-item" onclick="switchTab('datasource')">Payment API</div>
      <div class="arch-item" onclick="switchTab('datasource')">Auth API</div>
      <div class="arch-item" onclick="switchTab('datasource')">Tasks API</div>
      <div class="arch-item" onclick="switchTab('datasource')">+6 more</div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:#8b5cf6">
      <span class="layer-label" style="color:#8b5cf6">âš™ï¸ Service Layer (Business Logic)</span>
      <div class="arch-item" onclick="switchTab('backend')">AnalysisEngine<br><small style="color:var(--text2)">155KB</small></div>
      <div class="arch-item" onclick="switchTab('backend')">OptionsService<br><small style="color:var(--text2)">35KB</small></div>
      <div class="arch-item" onclick="switchTab('backend')">OptionScorer<br><small style="color:var(--text2)">35KB</small></div>
      <div class="arch-item" onclick="switchTab('backend')">AIService<br><small style="color:var(--text2)">52KB Gemini</small></div>
      <div class="arch-item" onclick="switchTab('backend')">PaymentService<br><small style="color:var(--text2)">Stripe</small></div>
      <div class="arch-item" onclick="switchTab('backend')">TaskQueue<br><small style="color:var(--text2)">Async</small></div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:#f59e0b">
      <span class="layer-label" style="color:#f59e0b">ğŸ“Š Data Layer (Market Data Service)</span>
      <div class="arch-item" onclick="switchTab('datasource')">MarketDataService<br><small style="color:var(--text2)">Multi-provider</small></div>
      <div class="arch-item" onclick="switchTab('datasource')">Cache (L1+L2)<br><small style="color:var(--text2)">Memory+DB</small></div>
      <div class="arch-item" onclick="switchTab('datasource')">Deduplicator<br><small style="color:var(--text2)">500ms</small></div>
      <div class="arch-item" onclick="switchTab('datasource')">HealthMonitor<br><small style="color:var(--text2)">Auto-recovery</small></div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:#ef4444">
      <span class="layer-label" style="color:#ef4444">ğŸŒ External Data Sources</span>
      <div class="arch-item">Yahoo Finance<br><small style="color:var(--text2)">US/HK/Aè‚¡ ä¸»è¦æº</small></div>
      <div class="arch-item">Tiger API<br><small style="color:var(--text2)">æœŸæƒ/æ¸¯è‚¡</small></div>
      <div class="arch-item">Tushare<br><small style="color:var(--text2)">Aè‚¡æ•°æ®</small></div>
      <div class="arch-item">Alpha Vantage<br><small style="color:var(--text2)">æŠ€æœ¯æŒ‡æ ‡</small></div>
      <div class="arch-item">DefeatBeta<br><small style="color:var(--text2)">è‡ªå®šä¹‰æ•°æ®</small></div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">è·¯ç”±åœ°å›¾ Routes</div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
    <div>
      <h4 style="margin-bottom:12px"><span class="dot dot-green"></span>Frontend Routes</h4>
      <table class="tbl">
        <tr><th>è·¯å¾„</th><th>ç»„ä»¶</th><th>è¯´æ˜</th></tr>
        <tr><td><code>/</code></td><td>NewLanding</td><td>é¦–é¡µè½åœ°é¡µ</td></tr>
        <tr><td><code>/stock</code></td><td>Home</td><td>è‚¡ç¥¨åˆ†æ</td></tr>
        <tr><td><code>/options</code></td><td>Options</td><td>æœŸæƒç ”ç©¶</td></tr>
        <tr><td><code>/options/reverse</code></td><td>ReverseScore</td><td>åå‘è¯„åˆ†</td></tr>
        <tr><td><code>/pricing</code></td><td>Pricing</td><td>è®¢é˜…å®šä»·</td></tr>
        <tr><td><code>/profile</code></td><td>Profile</td><td>ç”¨æˆ·ä¸­å¿ƒ</td></tr>
        <tr><td><code>/login</code></td><td>Login</td><td>ç™»å½•è®¤è¯</td></tr>
        <tr><td><code>/reset-password</code></td><td>ResetPassword</td><td>å¯†ç é‡ç½®</td></tr>
      </table>
    </div>
    <div>
      <h4 style="margin-bottom:12px"><span class="dot dot-blue"></span>Backend API Blueprints</h4>
      <table class="tbl">
        <tr><th>å‰ç¼€</th><th>æ¨¡å—</th><th>è¯´æ˜</th></tr>
        <tr><td><code>/api/stock</code></td><td>stock.py</td><td>è‚¡ç¥¨åˆ†æ</td></tr>
        <tr><td><code>/api/options</code></td><td>options.py</td><td>æœŸæƒåˆ†æ</td></tr>
        <tr><td><code>/api/auth</code></td><td>auth.py</td><td>ç”¨æˆ·è®¤è¯</td></tr>
        <tr><td><code>/api/user</code></td><td>user.py</td><td>ç”¨æˆ·èµ„æ–™</td></tr>
        <tr><td><code>/api/payment</code></td><td>payment.py</td><td>Stripeæ”¯ä»˜</td></tr>
        <tr><td><code>/api/portfolio</code></td><td>portfolio.py</td><td>æŠ•èµ„ç»„åˆ</td></tr>
        <tr><td><code>/api/tasks</code></td><td>tasks.py</td><td>å¼‚æ­¥ä»»åŠ¡</td></tr>
        <tr><td><code>/api/sector</code></td><td>sector.py</td><td>æ¿å—è½®åŠ¨</td></tr>
        <tr><td><code>/api/narrative</code></td><td>narrative_routes.py</td><td>AIå™è¿°</td></tr>
        <tr><td><code>/api/metrics</code></td><td>metrics.py</td><td>å¸‚åœºæŒ‡æ ‡</td></tr>
        <tr><td><code>/api/feedback</code></td><td>feedback.py</td><td>ç”¨æˆ·åé¦ˆ</td></tr>
        <tr><td><code>/api/analytics</code></td><td>analytics.py</td><td>è¡Œä¸ºåˆ†æ</td></tr>
      </table>
    </div>
  </div>
</div>

</div>

<!-- ===================== TAB 2: STOCK ANALYSIS ===================== -->
<div class="panel" id="panel-stock">

<div class="section">
  <div class="section-title">è‚¡ç¥¨åˆ†æå®Œæ•´æµç¨‹ Stock Analysis Flow</div>
  <p style="color:var(--text2);margin-bottom:20px">æ ¸å¿ƒæ¨¡å‹: <strong style="color:var(--teal)">G = B + M</strong> (Gain = Basics + Momentum) â€” åŸºæœ¬é¢ä¸åŠ¨é‡ç»“åˆçš„é‡åŒ–åˆ†ææ¨¡å‹</p>

  <div class="flow" style="flex-wrap:wrap;justify-content:center">
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>ğŸ‘¤ ç”¨æˆ·è¾“å…¥</h4><p>æœç´¢è‚¡ç¥¨ä»£ç </p>
      <div class="detail">
        <strong>ç»„ä»¶:</strong> StockSearchInput<br>
        <code>frontend/src/components/ui/StockSearchInput.tsx</code><br><br>
        <strong>åŠŸèƒ½:</strong> 300msé˜²æŠ– + æœ¬åœ°/è¿œç¨‹åŒæœç´¢<br>
        æ”¯æŒæ ¼å¼: AAPL, 700â†’0700.HK, 600519â†’SS<br>
        æ‹¼éŸ³æœç´¢: pgâ†’è‹¹æœ, ggâ†’è°·æ­Œ
      </div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>ğŸ¯ é€‰æ‹©åˆ†æé£æ ¼</h4><p>quality/value/growth/momentum</p>
      <div class="detail">
        <strong>4ç§é£æ ¼:</strong><br>
        â€¢ <strong>Quality</strong> - è´¨é‡ä¼˜å…ˆ (ä½é£é™©ç¨³å¥)<br>
        â€¢ <strong>Value</strong> - ä»·å€¼æŠ•èµ„ (ä½ä¼°å€¼å¯»å®)<br>
        â€¢ <strong>Growth</strong> - æˆé•¿å¯¼å‘ (é«˜å¢é€Ÿ)<br>
        â€¢ <strong>Momentum</strong> - åŠ¨é‡ç­–ç•¥ (è¶‹åŠ¿è¿½è¸ª)
      </div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>ğŸ“¡ POST /stock/analyze</h4><p>åˆ›å»ºå¼‚æ­¥åˆ†æä»»åŠ¡</p>
      <div class="detail">
        <code>backend/app/api/stock.py:586</code><br><br>
        <strong>è¯·æ±‚:</strong> {ticker, style, priority}<br>
        <strong>ç¼“å­˜ç­–ç•¥ (3å±‚):</strong><br>
        A. å½“æ—¥ç¼“å­˜å‘½ä¸­ â†’ ç›´æ¥è¿”å›<br>
        B. åŒä¸€ä»»åŠ¡è¿›è¡Œä¸­ â†’ åˆ›å»ºç­‰å¾…ä»»åŠ¡<br>
        C. æ— ç¼“å­˜ â†’ åˆ›å»ºçœŸå®åˆ†æä»»åŠ¡
      </div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>âš¡ Task Queue</h4><p>å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—å¤„ç†</p>
      <div class="detail">
        <code>backend/app/services/task_queue.py</code><br><br>
        <strong>æœºåˆ¶:</strong> å¤šçº¿ç¨‹è‡ªå®šä¹‰ä»»åŠ¡é˜Ÿåˆ—<br>
        <strong>ä¼˜å…ˆçº§:</strong> priority=100 (é»˜è®¤)<br>
        <strong>å‰ç«¯è½®è¯¢:</strong> useTaskPolling hook<br>
        <code>frontend/src/hooks/useTaskPolling.ts</code>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">8æ­¥åˆ†æç®¡é“ Analysis Pipeline</div>
  <p style="color:var(--text2);margin-bottom:16px">ç‚¹å‡»æ¯ä¸ªæ­¥éª¤æŸ¥çœ‹è¯¦ç»†å®ç° â€” æ ¸å¿ƒå‡½æ•°: <code style="color:var(--teal)">get_stock_analysis_data()</code> <small style="color:var(--text2)">stock.py:248-485</small></p>

  <div class="pipeline" id="stockPipeline">
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 1</span>
      ğŸ“Š è·å–å¸‚åœºæ•°æ®
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> analysis_engine.get_market_data(ticker)<br>
        <code>backend/app/analysis/stock_analysis/core/data_fetcher.py:40</code><br><br>
        <strong>æ•°æ®æµ:</strong><br>
        DataProvider(ticker).info â†’ MarketDataService â†’ Multi-adapter failover<br><br>
        <strong>è·å–æ•°æ®:</strong> ä»·æ ¼ã€å¸‚å€¼ã€PE/PEGã€Betaã€è‚¡æ¯ç‡ã€52å‘¨é«˜ä½ã€æˆäº¤é‡ã€è¡Œä¸šåˆ†ç±»ç­‰<br><br>
        <strong>æµåŠ¨æ€§æ£€æŸ¥:</strong> æ—¥å‡æˆäº¤é¢ â‰¥ $5M<br>
        <code>calculator.py:36-62</code>
      </div>
    </div>
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 2</span>
      âš ï¸ é£é™©åˆ†æ
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> analyze_risk_and_position(style, data)<br>
        <code>backend/app/analysis/stock_analysis/strategies/basic.py:47</code><br><br>
        <strong>5å¤§é£é™©æ”¯æŸ±:</strong><br>
        1. ä¼°å€¼é£é™© (PE/PEG/EV)<br>
        2. æˆé•¿é£é™© (æ”¶å…¥/åˆ©æ¶¦å¢é€Ÿ)<br>
        3. æµåŠ¨æ€§é£é™© (æˆäº¤é‡/å¸‚å€¼)<br>
        4. å¸‚åœºé£é™© (Beta/VIX)<br>
        5. æŠ€æœ¯é£é™© (å½¢æ€/æ”¯æ’‘ä½)<br><br>
        <strong>è¾“å‡º:</strong> risk_score(0-10), risk_level, suggested_position(0-100%)
      </div>
    </div>
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 3</span>
      ğŸŒ¡ï¸ å¸‚åœºæƒ…ç»ª
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> calculate_market_sentiment(data)<br>
        <code>backend/app/services/analysis_engine.py</code><br><br>
        <strong>ç»¼åˆå› å­:</strong><br>
        â€¢ VIXææ…ŒæŒ‡æ•°<br>
        â€¢ è¡Œä¸šæ™¯æ°”åº¦<br>
        â€¢ èµ„é‡‘æµå‘<br>
        â€¢ æŠ€æœ¯é¢ä¿¡å·<br><br>
        <strong>è¾“å‡º:</strong> sentiment_score(0-10)
      </div>
    </div>
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 4</span>
      ğŸ¯ ç›®æ ‡ä»·è®¡ç®—
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> calculate_target_price(data, risk, style)<br>
        <code>stock.py:290-323</code><br><br>
        <strong>5ç§ä¼°å€¼æ–¹æ³•:</strong><br>
        1. PEä¼°å€¼æ³•<br>
        2. PEGä¼°å€¼æ³•<br>
        3. å¢é•¿æŠ˜ç°æ³•<br>
        4. DCFç°é‡‘æµæŠ˜ç°<br>
        5. æŠ€æœ¯åˆ†ææ³•<br><br>
        <strong>åŠ¨æ€ä»“ä½è°ƒæ•´:</strong> æ ¹æ®upside%è‡ªåŠ¨è°ƒä»“
      </div>
    </div>
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 4.5</span>
      ğŸ“ ATRæ­¢æŸ
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> calculate_atr_stop_loss()<br><br>
        <strong>ç®—æ³•:</strong><br>
        1. è·å–1ä¸ªæœˆå†å²OHLCæ•°æ®<br>
        2. è®¡ç®—ATR (Average True Range)<br>
        3. VIXè°ƒæ•´ç³»æ•° (é«˜æ³¢åŠ¨â†’å®½æ­¢æŸ)<br>
        4. Betaè°ƒæ•´ (é«˜Betaâ†’å®½æ­¢æŸ)<br><br>
        <strong>å…¬å¼:</strong> Stop = Price - ATR Ã— Multiplier Ã— VIX_adj
      </div>
    </div>
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 4.6</span>
      ğŸ”„ æ¿å—è½®åŠ¨
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> sector_service.analyze_stock_sector()<br>
        <code>backend/app/api/sector.py</code><br><br>
        <strong>åˆ†æå†…å®¹:</strong><br>
        â€¢ æ¿å—å¼ºåº¦è¯„åˆ†<br>
        â€¢ è½®åŠ¨å‘¨æœŸåˆ¤æ–­<br>
        â€¢ æ¿å—vsä¸ªè‚¡å¯¹é½åº¦<br>
        â€¢ èµ„é‡‘æµå…¥/æµå‡ºè¶‹åŠ¿
      </div>
    </div>
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 4.7</span>
      ğŸ’° èµ„é‡‘ç»“æ„
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> capital_service.analyze_stock_capital()<br><br>
        <strong>åˆ†æå†…å®¹:</strong><br>
        â€¢ è·å–3ä¸ªæœˆå†å²æ•°æ®<br>
        â€¢ èµ„é‡‘é›†ä¸­åº¦ (ConcentrationGauge)<br>
        â€¢ ä¼ æ’­é˜¶æ®µ (PropagationStage)<br>
        â€¢ ä¸»åŠ›vsæ•£æˆ·èµ„é‡‘æµ
      </div>
    </div>
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 4.8</span>
      ğŸ“ˆ EVæ¨¡å‹
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> ev_model.calculate_ev_model_extended()<br>
        <code>backend/app/services/ev_model.py (32KB)</code><br><br>
        <strong>æ‰©å±•ç‰ˆEVæ¨¡å‹:</strong><br>
        â€¢ åŸºç¡€EV (Enterprise Value)<br>
        â€¢ + æ¿å—è½®åŠ¨å› å­<br>
        â€¢ + èµ„é‡‘ç»“æ„å› å­<br>
        â€¢ å¤šæ—¶é—´æ¡†æ¶åŠ æƒ
      </div>
    </div>
    <div class="pipe-step" onclick="togglePipe(this)">
      <span class="step-num">Step 5</span>
      ğŸ¤– AIåˆ†æ
      <div class="step-detail">
        <strong>å‡½æ•°:</strong> ai_service.get_gemini_analysis()<br>
        <code>backend/app/services/ai_service.py (52KB)</code><br><br>
        <strong>AIå¼•æ“:</strong> Google Gemini<br>
        <strong>è¾“å…¥:</strong> ticker, style, market_data, risk_result<br>
        <strong>è¾“å‡º:</strong> æŠ•èµ„è®ºç‚¹å™è¿°æŠ¥å‘Š<br>
        <strong>é™çº§:</strong> Geminiä¸å¯ç”¨æ—¶ â†’ è§„åˆ™å¼•æ“ç”Ÿæˆ<br>
        <strong>å¤šè¯­è¨€:</strong> ä¸­è‹±æ–‡æŠ¥å‘Š
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">49ä¸ªå¸‚åœºé¢„è­¦è§¦å‘å™¨ Market Warnings</div>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px">
    <div class="card" style="padding:14px"><h4 style="font-size:12px">ä¼°å€¼é¢„è­¦</h4><p>PE>50, PEG>3, å¸‚å€¼å¼‚å¸¸</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:12px">æŠ€æœ¯é¢„è­¦</h4><p>å‡çº¿æ­»å‰, è·Œç ´æ”¯æ’‘, RSIè¶…ä¹°</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:12px">æµåŠ¨æ€§é¢„è­¦</h4><p>æˆäº¤é‡èç¼©, æ—¥å‡<$5M</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:12px">æ³¢åŠ¨ç‡é¢„è­¦</h4><p>VIX>30, Beta>2, ATRå¼‚å¸¸</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:12px">åŸºæœ¬é¢é¢„è­¦</h4><p>æ”¶å…¥ä¸‹æ»‘, åˆ©æ¶¦ç‡æ”¶ç¼©, å€ºåŠ¡ä¸Šå‡</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:12px">èµ„é‡‘é¢é¢„è­¦</h4><p>ä¸»åŠ›å‡ºé€ƒ, èèµ„ä½™é¢ä¸‹é™</p></div>
  </div>
</div>

<div class="section">
  <div class="section-title">å›¾è¡¨æ¸²æŸ“ Chart Rendering</div>
  <div class="cards" style="grid-template-columns:1fr 1fr">
    <div class="card">
      <h3><span class="dot dot-teal"></span>Kçº¿å›¾ Candlestick</h3>
      <p><code>frontend/src/components/ui/KlineChart.tsx</code></p>
      <div style="margin-top:12px;font-size:12px;color:var(--text2)">
        <strong>åº“:</strong> TradingView Lightweight Charts 5.1<br>
        <strong>æ•°æ®:</strong> OHLC (Open/High/Low/Close)<br>
        <strong>æ ‡è®°çº¿:</strong> å½“å‰ä»·ã€è¡Œæƒä»·ã€æ­¢æŸä»·<br>
        <strong>äº¤äº’:</strong> åå­—å…‰æ ‡ã€ç¼©æ”¾ã€æš—è‰²ä¸»é¢˜
      </div>
    </div>
    <div class="card">
      <h3><span class="dot dot-green"></span>æŠ˜çº¿å›¾ Line Chart</h3>
      <p><code>frontend/src/pages/Home.tsx:100-170</code></p>
      <div style="margin-top:12px;font-size:12px;color:var(--text2)">
        <strong>åº“:</strong> Chart.js 4.5<br>
        <strong>æ•°æ®:</strong> å†å²æ”¶ç›˜ä»·æ—¶åº<br>
        <strong>æ ·å¼:</strong> å¡«å……åŒºåŸŸã€å¹³æ»‘æ›²çº¿ã€æ— æ•°æ®ç‚¹<br>
        <strong>é¢œè‰²:</strong> #0D9B97 (å“ç‰Œè‰²)
      </div>
    </div>
  </div>
</div>
</div>

<!-- ===================== TAB 3: OPTIONS ANALYSIS ===================== -->
<div class="panel" id="panel-options">

<div class="section">
  <div class="section-title">æœŸæƒåˆ†æå‘å¯¼æµç¨‹ Options Wizard Flow</div>
  <p style="color:var(--text2);margin-bottom:20px">æ­¥éª¤å‘å¯¼å¼äº¤äº’ â€” æ”¯æŒå¤šæ ‡çš„ + å¤šåˆ°æœŸæ—¥æ‰¹é‡åˆ†æ</p>

  <div class="wizard">
    <div class="wizard-step">
      <div class="wizard-col">
        <div class="wizard-dot active" onclick="showWizardDetail(1)">1</div>
        <div class="wizard-label">é€‰æ‹©æ ‡çš„</div>
      </div>
      <div class="wizard-line"></div>
    </div>
    <div class="wizard-step">
      <div class="wizard-col">
        <div class="wizard-dot" onclick="showWizardDetail(2)">2</div>
        <div class="wizard-label">åŠ è½½åˆ°æœŸæ—¥</div>
      </div>
      <div class="wizard-line"></div>
    </div>
    <div class="wizard-step">
      <div class="wizard-col">
        <div class="wizard-dot" onclick="showWizardDetail(3)">3</div>
        <div class="wizard-label">é€‰æ‹©åˆ°æœŸæ—¥</div>
      </div>
      <div class="wizard-line"></div>
    </div>
    <div class="wizard-step">
      <div class="wizard-col">
        <div class="wizard-dot" onclick="showWizardDetail(4)">4</div>
        <div class="wizard-label">é€‰æ‹©ç­–ç•¥</div>
      </div>
      <div class="wizard-line"></div>
    </div>
    <div class="wizard-step">
      <div class="wizard-col">
        <div class="wizard-dot" onclick="showWizardDetail(5)">5</div>
        <div class="wizard-label">åˆ†ææ‰§è¡Œ</div>
      </div>
      <div class="wizard-line"></div>
    </div>
    <div class="wizard-step">
      <div class="wizard-col">
        <div class="wizard-dot" onclick="showWizardDetail(6)">6</div>
        <div class="wizard-label">ç»“æœå±•ç¤º</div>
      </div>
    </div>
  </div>

  <div id="wizardDetail" style="margin:20px auto;max-width:700px">
    <div class="card" id="wizDetail1">
      <h3>Step 1: é€‰æ‹©æ ‡çš„ Symbol Selection</h3>
      <p style="margin:8px 0;font-size:13px;color:var(--text2)">
        <strong>ç»„ä»¶:</strong> MultiStockInput (æ”¯æŒæœ€å¤š3ä¸ªæ ‡çš„)<br>
        <code style="color:var(--teal)">frontend/src/components/ui/MultiStockInput.tsx</code><br><br>
        æ”¯æŒæ ¼å¼: US(AAPL), HK(0700), Aè‚¡(600519)<br>
        è‡ªåŠ¨è¡¥å…¨ + æ¨¡ç³Šæœç´¢
      </p>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">4å¤§ç­–ç•¥è¯„åˆ†ç³»ç»Ÿ Strategy Scoring</div>
  <div class="cards">
    <div class="card" style="border-top:3px solid var(--green)">
      <h3>ğŸ“‰ Sell Put (SPRV)</h3>
      <p style="font-size:12px;color:var(--text2);margin:8px 0">å–å‡ºè®¤æ²½ â€” ç¨³å¥æ”¶ç§Ÿ</p>
      <div style="font-size:11px">
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æƒåˆ©é‡‘æ”¶ç›Š</span><span style="color:var(--teal)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--teal)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æ”¯æ’‘ä½è·ç¦»</span><span style="color:var(--teal)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--teal)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>å®‰å…¨è¾¹é™…(ATR)</span><span style="color:var(--teal)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--teal)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>è¶‹åŠ¿ä¿¡å·</span><span style="color:var(--teal)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--teal)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>IVç™¾åˆ†ä½</span><span style="color:var(--teal)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--teal)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æµåŠ¨æ€§</span><span style="color:var(--teal)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--teal)"></div></div>
      </div>
      <p style="font-size:10px;margin-top:8px"><code>options_analysis/scoring/sell_put.py:44-126</code></p>
    </div>
    <div class="card" style="border-top:3px solid var(--blue)">
      <h3>ğŸ“ˆ Sell Call (SCRV)</h3>
      <p style="font-size:12px;color:var(--text2);margin:8px 0">å–å‡ºè®¤è´­ â€” é«˜ä½æ”¶å‰²</p>
      <div style="font-size:11px">
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æƒåˆ©é‡‘æ”¶ç›Š</span><span style="color:var(--blue)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--blue)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>é˜»åŠ›ä½è·ç¦»</span><span style="color:var(--blue)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--blue)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>è¶‹åŠ¿ä¿¡å·</span><span style="color:var(--blue)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--blue)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>å®‰å…¨è¾¹é™…</span><span style="color:var(--blue)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--blue)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>IVç™¾åˆ†ä½</span><span style="color:var(--blue)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--blue)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æµåŠ¨æ€§</span><span style="color:var(--blue)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--blue)"></div></div>
      </div>
      <p style="font-size:10px;margin-top:8px"><code>options_analysis/scoring/sell_call.py</code></p>
    </div>
    <div class="card" style="border-top:3px solid var(--orange)">
      <h3>ğŸš€ Buy Call (BCRV)</h3>
      <p style="font-size:12px;color:var(--text2);margin:8px 0">ä¹°å…¥è®¤è´­ â€” çœ‹æ¶¨æ æ†</p>
      <div style="font-size:11px">
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>åŠ¨é‡ä¿¡å·</span><span style="color:var(--orange)">25%</span></div>
        <div class="score-bar"><div class="fill" style="width:25%;background:var(--orange)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>çªç ´æ½œåŠ›</span><span style="color:var(--orange)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--orange)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>IVæ€§ä»·æ¯”</span><span style="color:var(--orange)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--orange)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æ—¶é—´ä»·å€¼</span><span style="color:var(--orange)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--orange)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æµåŠ¨æ€§</span><span style="color:var(--orange)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--orange)"></div></div>
      </div>
      <p style="font-size:10px;margin-top:8px"><code>options_analysis/scoring/buy_call.py:30-99</code></p>
    </div>
    <div class="card" style="border-top:3px solid var(--red)">
      <h3>ğŸ›¡ï¸ Buy Put (BPRV)</h3>
      <p style="font-size:12px;color:var(--text2);margin:8px 0">ä¹°å…¥è®¤æ²½ â€” çœ‹è·Œå¯¹å†²</p>
      <div style="font-size:11px">
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>çœ‹è·ŒåŠ¨é‡</span><span style="color:var(--red)">25%</span></div>
        <div class="score-bar"><div class="fill" style="width:25%;background:var(--red)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æ”¯æ’‘ç ´ä½</span><span style="color:var(--red)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--red)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æ³¢åŠ¨ç‡</span><span style="color:var(--red)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--red)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æ—¶é—´ä»·å€¼</span><span style="color:var(--red)">20%</span></div>
        <div class="score-bar"><div class="fill" style="width:20%;background:var(--red)"></div></div>
        <div style="display:flex;justify-content:space-between;margin:4px 0"><span>æµåŠ¨æ€§</span><span style="color:var(--red)">15%</span></div>
        <div class="score-bar"><div class="fill" style="width:15%;background:var(--red)"></div></div>
      </div>
      <p style="font-size:10px;margin-top:8px"><code>options_analysis/scoring/buy_put.py</code></p>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">æœŸæƒæ•°æ®ç»“æ„ Option Data Structure</div>
  <div class="collapse-header" onclick="toggleCollapse(this)">OptionData æ ¸å¿ƒæ•°æ®å­—æ®µ</div>
  <div class="collapse-body">
    <table class="tbl">
      <tr><th>ç±»åˆ«</th><th>å­—æ®µ</th><th>è¯´æ˜</th></tr>
      <tr><td>æ ‡è¯†</td><td>identifier, symbol, strike, put_call, expiry_date</td><td>åˆçº¦æ ‡è¯†ä¿¡æ¯</td></tr>
      <tr><td>è¡Œæƒ…</td><td>bid_price, ask_price, latest_price, volume, open_interest</td><td>å®æ—¶è¡Œæƒ…æ•°æ®</td></tr>
      <tr><td>Greeks</td><td>implied_vol, delta, gamma, theta, vega, rho</td><td>æœŸæƒå¸Œè…Šå­—æ¯</td></tr>
      <tr><td>è¯„åˆ†</td><td>sprv, scrv, bcrv, bprv</td><td>4ç­–ç•¥ç»¼åˆè¯„åˆ†(0-100)</td></tr>
      <tr><td>è¡ç”Ÿ</td><td>iv_rank, iv_percentile, days_to_expiry, annualized_return</td><td>è¡ç”Ÿè®¡ç®—æŒ‡æ ‡</td></tr>
      <tr><td>é£æ§</td><td>assignment_probability, margin_requirement, premium</td><td>é£æ§ä¸æˆæœ¬</td></tr>
    </table>
    <p style="margin-top:8px;font-size:11px;color:var(--text2)"><code>frontend/src/types/options.ts:17-46</code></p>
  </div>

  <div class="collapse-header" onclick="toggleCollapse(this)" style="margin-top:12px">Black-Scholes æ¦‚ç‡è®¡ç®—</div>
  <div class="collapse-body">
    <div style="font-size:13px;font-family:monospace;background:var(--bg3);padding:16px;border-radius:8px;overflow-x:auto">
      <div style="color:var(--text2);margin-bottom:8px"># Sell Put: è‚¡ä»·ä¿æŒåœ¨è¡Œæƒä»·ä¹‹ä¸Šçš„æ¦‚ç‡</div>
      <div>d1 = (ln(S/K) + (r + ÏƒÂ²/2)t) / (Ïƒâˆšt)</div>
      <div>prob_profit = N(-d1)</div>
      <br>
      <div style="color:var(--text2);margin-bottom:8px"># Buy Call: è‚¡ä»·è¾¾åˆ°ç›ˆäºå¹³è¡¡çš„æ¦‚ç‡</div>
      <div>breakeven = strike + premium</div>
      <div>d1_be = (ln(S/breakeven) + (r + ÏƒÂ²/2)t) / (Ïƒâˆšt)</div>
      <div>prob_profit = N(d1_be)</div>
    </div>
    <p style="margin-top:8px;font-size:11px;color:var(--text2)">ä½¿ç”¨ scipy.stats.norm è®¡ç®—ç´¯ç§¯åˆ†å¸ƒå‡½æ•° | <code>docs/OPTIONS_ALGORITHM.md:318-327</code></p>
  </div>

  <div class="collapse-header" onclick="toggleCollapse(this)" style="margin-top:12px">å¢å¼ºåˆ†æ VRP + Risk Adjuster</div>
  <div class="collapse-body">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
      <div>
        <h4 style="margin-bottom:8px">VRP (æ³¢åŠ¨ç‡é£é™©æº¢ä»·)</h4>
        <p style="font-size:12px;color:var(--text2)">
          å¯¹æ¯”éšå«æ³¢åŠ¨ç‡ vs å·²å®ç°æ³¢åŠ¨ç‡<br>
          VRP = IV - RV â†’ æ­£å€¼è¡¨ç¤ºæœŸæƒè¢«é«˜ä¼°<br>
          <code>vrp_calculator.py:29-83</code>
        </p>
      </div>
      <div>
        <h4 style="margin-bottom:8px">è¶‹åŠ¿åˆ†æ (3ä¿¡å·æ³•)</h4>
        <p style="font-size:12px;color:var(--text2)">
          1. å‡çº¿ç³»ç»Ÿä¿¡å·<br>
          2. MACDåŠ¨é‡ä¿¡å·<br>
          3. ä»·æ ¼é€šé“ä¿¡å·<br>
          å…±è¯† â†’ è¶‹åŠ¿åˆ¤æ–­<br>
          <code>trend_analyzer.py</code>
        </p>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">æœŸæƒAPIç«¯ç‚¹ Options Endpoints</div>
  <table class="tbl">
    <tr><th>ç«¯ç‚¹</th><th>æ–¹æ³•</th><th>æ¨¡å¼</th><th>è¯´æ˜</th></tr>
    <tr><td><code>/api/options/expirations/&lt;symbol&gt;</code></td><td><span class="method get">GET</span></td><td>åŒæ­¥</td><td>è·å–å¯ç”¨åˆ°æœŸæ—¥åˆ—è¡¨</td></tr>
    <tr><td><code>/api/options/chain-async</code></td><td><span class="method post">POST</span></td><td>å¼‚æ­¥</td><td>åˆ›å»ºæœŸæƒé“¾åˆ†æä»»åŠ¡ (4ç­–ç•¥è¯„åˆ†)</td></tr>
    <tr><td><code>/api/options/chain/batch</code></td><td><span class="method post">POST</span></td><td>å¼‚æ­¥</td><td>æ‰¹é‡åˆ†æ (å¤šæ ‡çš„+å¤šåˆ°æœŸæ—¥)</td></tr>
    <tr><td><code>/api/options/enhanced-async</code></td><td><span class="method post">POST</span></td><td>å¼‚æ­¥</td><td>å¢å¼ºåˆ†æ (VRP+é£é™©è°ƒèŠ‚)</td></tr>
    <tr><td><code>/api/options/reverse-score</code></td><td><span class="method post">POST</span></td><td>åŒæ­¥</td><td>åå‘è¯„åˆ† (ç”¨æˆ·è¾“å…¥å‚æ•°â†’åˆ†æ•°)</td></tr>
    <tr><td><code>/api/options/recognize-image</code></td><td><span class="method post">POST</span></td><td>åŒæ­¥</td><td>æˆªå›¾è¯†åˆ«æœŸæƒå‚æ•° (Gemini)</td></tr>
    <tr><td><code>/api/options/quote/&lt;symbol&gt;</code></td><td><span class="method get">GET</span></td><td>åŒæ­¥</td><td>è·å–è‚¡ç¥¨æŠ¥ä»·</td></tr>
    <tr><td><code>/api/options/history</code></td><td><span class="method get">GET</span></td><td>åŒæ­¥</td><td>åˆ†æå†å² (åˆ†é¡µ)</td></tr>
    <tr><td><code>/api/options/recommendations</code></td><td><span class="method get">GET</span></td><td>åŒæ­¥</td><td>æ¯æ—¥çƒ­é—¨æœŸæƒæ¨è</td></tr>
  </table>
</div>
</div>

<!-- ===================== TAB 4: DATA SOURCES ===================== -->
<div class="panel" id="panel-datasource">

<div class="section">
  <div class="section-title">æ•°æ®æä¾›è€…æ¶æ„ Data Provider Architecture</div>
  <p style="color:var(--text2);margin-bottom:16px">MarketDataService é‡‡ç”¨é€‚é…å™¨æ¨¡å¼,æ”¯æŒå¤šæºè‡ªåŠ¨é™çº§å’Œè¯·æ±‚å»é‡</p>

  <div class="arch">
    <div class="arch-layer" style="border-color:var(--teal)">
      <span class="layer-label">MarketDataService (Singleton)</span>
      <div class="arch-item">get_quote()</div>
      <div class="arch-item">get_history()</div>
      <div class="arch-item">get_fundamentals()</div>
      <div class="arch-item">get_options_chain()</div>
      <div class="arch-item">get_ticker_data()</div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:var(--purple)">
      <span class="layer-label" style="color:var(--purple)">ä¸­é—´å±‚ Middleware</span>
      <div class="arch-item">Request Deduplicator<br><small style="color:var(--text2)">500msçª—å£å»é‡</small></div>
      <div class="arch-item">L1 Memory Cache<br><small style="color:var(--text2)">1000æ¡/60s-24h TTL</small></div>
      <div class="arch-item">L2 DB Cache<br><small style="color:var(--text2)">æ¯æ—¥åˆ†æç»“æœ</small></div>
      <div class="arch-item">Health Monitor<br><small style="color:var(--text2)">è‡ªåŠ¨æ¢å¤</small></div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:var(--orange)">
      <span class="layer-label" style="color:var(--orange)">Adapters é€‚é…å™¨</span>
      <div class="arch-item" style="border-color:var(--green)">YFinance<br><small style="color:var(--green)">Primary</small></div>
      <div class="arch-item" style="border-color:var(--blue)">Tiger API<br><small style="color:var(--blue)">Options+HK</small></div>
      <div class="arch-item" style="border-color:var(--orange)">Tushare<br><small style="color:var(--orange)">A-shares</small></div>
      <div class="arch-item" style="border-color:var(--purple)">Alpha Vantage<br><small style="color:var(--purple)">Technical</small></div>
      <div class="arch-item" style="border-color:var(--pink)">DefeatBeta<br><small style="color:var(--pink)">Custom</small></div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">5å¤§æ•°æ®æºè¯¦æƒ… Data Providers</div>
  <div class="cards">
    <div class="provider-card">
      <div class="priority" style="background:#10b98130;color:#10b981">PRIMARY</div>
      <h4><span class="dot dot-green"></span>Yahoo Finance (yfinance)</h4>
      <ul>
        <li>US / HK / Aè‚¡ è‚¡ç¥¨è¡Œæƒ…</li>
        <li>å†å²OHLCVä»·æ ¼æ•°æ®</li>
        <li>åŸºæœ¬é¢æ•°æ® (PE, PEG, Revenue)</li>
        <li>VIX, å›½å€ºæ”¶ç›Šç‡, é»„é‡‘, åŸæ²¹</li>
        <li>æœŸæƒé“¾ (USè‚¡ç¥¨)</li>
        <li>å…è´¹,æ— éœ€API Key</li>
      </ul>
    </div>
    <div class="provider-card">
      <div class="priority" style="background:#3b82f630;color:#3b82f6">OPTIONS</div>
      <h4><span class="dot dot-blue"></span>Tiger Broker API (tigeropen)</h4>
      <ul>
        <li>æ¸¯è‚¡å®æ—¶è¡Œæƒ… (0700.HKç­‰)</li>
        <li>US/HKæœŸæƒé“¾ (å«Greeks)</li>
        <li>æœŸæƒåˆ°æœŸæ—¥åˆ—è¡¨</li>
        <li>ä¿è¯é‡‘ç‡æŸ¥è¯¢</li>
        <li>éœ€è¦TIGER_API_KEY</li>
      </ul>
    </div>
    <div class="provider-card">
      <div class="priority" style="background:#f59e0b30;color:#f59e0b">A-SHARE</div>
      <h4><span class="dot dot-orange"></span>Tushare</h4>
      <ul>
        <li>Aè‚¡ä¸“ç”¨æ•°æ®æº</li>
        <li>ä¸Šäº¤æ‰€/æ·±äº¤æ‰€è‚¡ç¥¨</li>
        <li>å…¬å¸åŸºæœ¬é¢ä¿¡æ¯</li>
        <li>éœ€è¦TUSHARE_API_KEY</li>
      </ul>
    </div>
    <div class="provider-card">
      <div class="priority" style="background:#8b5cf630;color:#8b5cf6">TECHNICAL</div>
      <h4><span class="dot dot-purple"></span>Alpha Vantage</h4>
      <ul>
        <li>æŠ€æœ¯åˆ†ææŒ‡æ ‡</li>
        <li>USè‚¡ç¥¨/å¤–æ±‡/åŠ å¯†è´§å¸</li>
        <li>Rate-limited (5 calls/min free)</li>
        <li>éœ€è¦ALPHAVANTAGE_API_KEY</li>
      </ul>
    </div>
    <div class="provider-card">
      <div class="priority" style="background:#ec489930;color:#ec4899">CUSTOM</div>
      <h4><span class="dot dot-pink"></span>DefeatBeta</h4>
      <ul>
        <li>è‡ªå®šä¹‰/ç¼“å­˜æ•°æ®æº</li>
        <li>ä¸“æœ‰è®¤è¯æœºåˆ¶</li>
        <li>å¤‡ç”¨æ•°æ®é™çº§</li>
      </ul>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">å…¨éƒ¨APIç«¯ç‚¹ All Endpoints</div>

  <div class="collapse-header" onclick="toggleCollapse(this)">Stock API (è‚¡ç¥¨åˆ†æ) â€” 5ä¸ªç«¯ç‚¹</div>
  <div class="collapse-body">
    <table class="tbl"><tr><th>ç«¯ç‚¹</th><th>æ–¹æ³•</th><th>è®¤è¯</th><th>è¯´æ˜</th><th>æ–‡ä»¶ä½ç½®</th></tr>
    <tr><td><code>/api/stock/search</code></td><td><span class="method get">GET</span></td><td>-</td><td>æ¨¡ç³Šæœç´¢è‚¡ç¥¨</td><td>stock.py:157</td></tr>
    <tr><td><code>/api/stock/analyze</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>å®Œæ•´è‚¡ç¥¨åˆ†æ(å¼‚æ­¥)</td><td>stock.py:586</td></tr>
    <tr><td><code>/api/stock/analyze-async</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>åˆ›å»ºå¼‚æ­¥åˆ†æä»»åŠ¡</td><td>stock.py:487</td></tr>
    <tr><td><code>/api/stock/history</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>åˆ†æå†å²åˆ—è¡¨</td><td>stock.py:696</td></tr>
    <tr><td><code>/api/stock/summary</code></td><td><span class="method get">GET</span></td><td>-</td><td>å¿«é€ŸæŠ¥ä»·</td><td>stock.py:917</td></tr>
    </table>
  </div>

  <div class="collapse-header" onclick="toggleCollapse(this)">Options API (æœŸæƒåˆ†æ) â€” 11ä¸ªç«¯ç‚¹</div>
  <div class="collapse-body">
    <table class="tbl"><tr><th>ç«¯ç‚¹</th><th>æ–¹æ³•</th><th>è®¤è¯</th><th>è¯´æ˜</th><th>æ–‡ä»¶ä½ç½®</th></tr>
    <tr><td><code>/api/options/expirations/:sym</code></td><td><span class="method get">GET</span></td><td>-</td><td>åˆ°æœŸæ—¥åˆ—è¡¨</td><td>options.py:164</td></tr>
    <tr><td><code>/api/options/chain-async</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>æœŸæƒé“¾åˆ†æä»»åŠ¡</td><td>options.py:50</td></tr>
    <tr><td><code>/api/options/chain/batch</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>æ‰¹é‡æœŸæƒé“¾</td><td>options.py:616</td></tr>
    <tr><td><code>/api/options/enhanced-async</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>VRP+Riskåˆ†æ</td><td>options.py:106</td></tr>
    <tr><td><code>/api/options/reverse-score</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>åå‘è¯„åˆ†</td><td>options.py:519</td></tr>
    <tr><td><code>/api/options/recognize-image</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>æˆªå›¾OCR</td><td>options.py:727</td></tr>
    <tr><td><code>/api/options/quote/:sym</code></td><td><span class="method get">GET</span></td><td>-</td><td>è‚¡ç¥¨æŠ¥ä»·</td><td>options.py:226</td></tr>
    <tr><td><code>/api/options/history/:sym</code></td><td><span class="method get">GET</span></td><td>-</td><td>ä»·æ ¼å†å²</td><td>options.py:236</td></tr>
    <tr><td><code>/api/options/history</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>åˆ†æå†å²(åˆ†é¡µ)</td><td>options.py:301</td></tr>
    <tr><td><code>/api/options/history/:id</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>å†å²è¯¦æƒ…</td><td>options.py:404</td></tr>
    <tr><td><code>/api/options/recommendations</code></td><td><span class="method get">GET</span></td><td>-</td><td>æ¯æ—¥æ¨è</td><td>options.py:479</td></tr>
    </table>
  </div>

  <div class="collapse-header" onclick="toggleCollapse(this)">Auth & User API â€” 4ä¸ªç«¯ç‚¹</div>
  <div class="collapse-body">
    <table class="tbl"><tr><th>ç«¯ç‚¹</th><th>æ–¹æ³•</th><th>è®¤è¯</th><th>è¯´æ˜</th></tr>
    <tr><td><code>/api/auth/status</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>ç™»å½•çŠ¶æ€æ£€æŸ¥</td></tr>
    <tr><td><code>/api/user/profile</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>ç”¨æˆ·èµ„æ–™</td></tr>
    <tr><td><code>/api/user/credits</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>æŸ¥è¯¢ä¿¡ç”¨é¢åº¦</td></tr>
    <tr><td><code>/api/user/usage</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>ä½¿ç”¨è®°å½•</td></tr>
    </table>
  </div>

  <div class="collapse-header" onclick="toggleCollapse(this)">Payment API (Stripe) â€” 5ä¸ªç«¯ç‚¹</div>
  <div class="collapse-body">
    <table class="tbl"><tr><th>ç«¯ç‚¹</th><th>æ–¹æ³•</th><th>è®¤è¯</th><th>è¯´æ˜</th></tr>
    <tr><td><code>/api/payment/create-checkout-session</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>åˆ›å»ºStripeç»“è´¦ä¼šè¯</td></tr>
    <tr><td><code>/api/payment/webhook</code></td><td><span class="method post">POST</span></td><td>Stripeç­¾å</td><td>Stripe Webhookå›è°ƒ</td></tr>
    <tr><td><code>/api/payment/credits</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>æŸ¥è¯¢å‰©ä½™é¢åº¦</td></tr>
    <tr><td><code>/api/payment/subscription</code></td><td><span class="method get">GET</span></td><td>JWT</td><td>è®¢é˜…çŠ¶æ€</td></tr>
    <tr><td><code>/api/payment/cancel</code></td><td><span class="method post">POST</span></td><td>JWT</td><td>å–æ¶ˆè®¢é˜…</td></tr>
    </table>
  </div>

  <div class="collapse-header" onclick="toggleCollapse(this)">Portfolio / Tasks / Other APIs</div>
  <div class="collapse-body">
    <table class="tbl"><tr><th>ç«¯ç‚¹</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr>
    <tr><td><code>/api/portfolio/holdings</code></td><td><span class="method get">GET</span></td><td>æŒä»“åˆ—è¡¨</td></tr>
    <tr><td><code>/api/portfolio/pnl</code></td><td><span class="method get">GET</span></td><td>ç›ˆäºå†å²</td></tr>
    <tr><td><code>/api/portfolio/rebalance</code></td><td><span class="method post">POST</span></td><td>å†å¹³è¡¡å»ºè®®</td></tr>
    <tr><td><code>/api/tasks/:id</code></td><td><span class="method get">GET</span></td><td>æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€</td></tr>
    <tr><td><code>/api/sector/analyze</code></td><td><span class="method post">POST</span></td><td>æ¿å—è½®åŠ¨åˆ†æ</td></tr>
    <tr><td><code>/api/feedback</code></td><td><span class="method post">POST</span></td><td>æäº¤åé¦ˆ</td></tr>
    <tr><td><code>/api/analytics/event</code></td><td><span class="method post">POST</span></td><td>è¡Œä¸ºè¿½è¸ª</td></tr>
    <tr><td><code>/api/narrative/generate</code></td><td><span class="method post">POST</span></td><td>AIå™è¿°ç”Ÿæˆ</td></tr>
    <tr><td><code>/api/metrics/health</code></td><td><span class="method get">GET</span></td><td>Providerå¥åº·çŠ¶æ€</td></tr>
    </table>
  </div>
</div>

<div class="section">
  <div class="section-title">æ•°æ®é™çº§é“¾ Failover Chain</div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
    <div class="card" style="padding:16px">
      <h4 style="margin-bottom:8px">US è‚¡ç¥¨æ•°æ®</h4>
      <div style="font-size:12px">
        <span class="badge badge-green">YFinance</span> â†’ <span class="badge badge-purple">Alpha Vantage</span> â†’ <span class="badge badge-pink">DefeatBeta</span>
      </div>
    </div>
    <div class="card" style="padding:16px">
      <h4 style="margin-bottom:8px">HK æ¸¯è‚¡æ•°æ®</h4>
      <div style="font-size:12px">
        <span class="badge badge-blue">Tiger API</span> â†’ <span class="badge badge-green">YFinance</span> (0700.HKæ ¼å¼)
      </div>
    </div>
    <div class="card" style="padding:16px">
      <h4 style="margin-bottom:8px">Aè‚¡ æ•°æ®</h4>
      <div style="font-size:12px">
        <span class="badge badge-orange">Tushare</span> â†’ <span class="badge badge-green">YFinance</span> (SS/SZåç¼€)
      </div>
    </div>
    <div class="card" style="padding:16px">
      <h4 style="margin-bottom:8px">æœŸæƒé“¾æ•°æ®</h4>
      <div style="font-size:12px">
        <span class="badge badge-blue">Tiger API</span> â†’ <span class="badge badge-green">YFinance</span> â†’ <span class="badge badge-red">Mock Data</span>
      </div>
    </div>
    <div class="card" style="padding:16px">
      <h4 style="margin-bottom:8px">å®è§‚æŒ‡æ ‡ (VIXç­‰)</h4>
      <div style="font-size:12px">
        <span class="badge badge-green">YFinance</span> (å•ä¸€æº)
      </div>
    </div>
    <div class="card" style="padding:16px">
      <h4 style="margin-bottom:8px">æ±‡ç‡æ•°æ®</h4>
      <div style="font-size:12px">
        <span class="badge badge-teal">ExchangeRate-API</span> â†’ <span class="badge badge-red">ç¡¬ç¼–ç  7.8/7.2</span>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ===================== TAB 5: FRONTEND ===================== -->
<div class="panel" id="panel-frontend">

<div class="section">
  <div class="section-title">Provider å±‚çº§ Context Stack</div>
  <div class="vflow">
    <div class="flow-node" onclick="toggleNode(this)" style="border-color:var(--purple)">
      <h4>AuthProvider</h4><p>Supabase JWT ä¼šè¯ç®¡ç†</p>
      <div class="detail"><code>components/auth/AuthProvider.tsx</code><br>State: session, user, loading, signOut</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)" style="border-color:var(--blue)">
      <h4>UserDataProvider</h4><p>ç”¨æˆ·æ•°æ® (é¢åº¦/äº¤æ˜“/ä½¿ç”¨è®°å½•)</p>
      <div class="detail"><code>components/auth/UserDataProvider.tsx</code><br>State: credits, pricing, transactions, usageLogs</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)" style="border-color:var(--orange)">
      <h4>ThemeProvider</h4><p>æš—è‰²/äº®è‰²ä¸»é¢˜åˆ‡æ¢</p>
      <div class="detail"><code>components/theme-provider.tsx</code><br>State: theme, setTheme (localStorageæŒä¹…åŒ–)</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)" style="border-color:var(--teal)">
      <h4>App (Router + Analytics)</h4><p>è·¯ç”± + ToastProvider + AnalyticsProvider</p>
      <div class="detail"><code>src/App.tsx</code><br>BrowserRouter + HelmetProvider + Routes</div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">ç»„ä»¶æ ‘ Component Tree</div>
  <div style="columns:2;gap:24px">

  <div class="tree">
    <div class="tree-toggle" onclick="toggleTree(this)">ğŸ“ pages/ (9ä¸ªé¡µé¢)</div>
    <div class="tree-children">
      <div class="tree-item">ğŸ“„ Home.tsx <span class="badge badge-green">è‚¡ç¥¨åˆ†æ</span></div>
      <div class="tree-item">ğŸ“„ Options.tsx <span class="badge badge-blue">æœŸæƒåˆ†æ</span></div>
      <div class="tree-item">ğŸ“„ ReverseScore.tsx <span class="badge badge-purple">åå‘è¯„åˆ†</span></div>
      <div class="tree-item">ğŸ“„ Pricing.tsx <span class="badge badge-orange">è®¢é˜…å®šä»·</span></div>
      <div class="tree-item">ğŸ“„ Profile.tsx <span class="badge badge-teal">ç”¨æˆ·ä¸­å¿ƒ</span></div>
      <div class="tree-item">ğŸ“„ Login.tsx <span class="badge badge-red">ç™»å½•</span></div>
      <div class="tree-item">ğŸ“„ ResetPassword.tsx</div>
      <div class="tree-item">ğŸ“„ NewLanding.tsx <span class="badge badge-teal">é¦–é¡µ</span></div>
      <div class="tree-item">ğŸ“„ Landing.tsx (æ—§ç‰ˆ)</div>
    </div>
  </div>

  <div class="tree">
    <div class="tree-toggle" onclick="toggleTree(this)">ğŸ“ components/ui/ (UIåŸºç¡€ç»„ä»¶)</div>
    <div class="tree-children">
      <div class="tree-item">button.tsx <span class="tag">10ç§variant</span></div>
      <div class="tree-item">card.tsx <span class="tag">6ç§variant</span></div>
      <div class="tree-item">dialog.tsx (Radix)</div>
      <div class="tree-item">tabs.tsx (Radix)</div>
      <div class="tree-item">accordion.tsx (Radix)</div>
      <div class="tree-item">select.tsx / checkbox.tsx</div>
      <div class="tree-item">table.tsx / badge.tsx / alert.tsx</div>
      <div class="tree-item">toast.tsx / input.tsx / textarea.tsx</div>
      <div class="tree-item">dropdown-menu.tsx / scroll-area.tsx</div>
      <div class="tree-item">Skeleton.tsx / ErrorAlert.tsx</div>
      <div class="tree-item">LoadingScreen.tsx</div>
      <div class="tree-item">StockSearchInput.tsx <span class="badge badge-green">æœç´¢</span></div>
      <div class="tree-item">MultiStockInput.tsx <span class="badge badge-blue">å¤šé€‰</span></div>
      <div class="tree-item">CustomSelect.tsx</div>
      <div class="tree-item">KlineChart.tsx <span class="badge badge-teal">Kçº¿</span></div>
      <div class="tree-item">theme-toggle.tsx / language-toggle.tsx</div>
    </div>
  </div>

  <div class="tree">
    <div class="tree-toggle" onclick="toggleTree(this)">ğŸ“ components/ (åŠŸèƒ½ç»„ä»¶)</div>
    <div class="tree-children">
      <div class="tree-item">StockAnalysisHistory.tsx</div>
      <div class="tree-item">OptionsAnalysisHistory.tsx</div>
      <div class="tree-item">SimulatedPortfolio.tsx</div>
      <div class="tree-item">HotRecommendations.tsx</div>
      <div class="tree-item">NarrativeRadar.tsx <span class="badge badge-purple">é›·è¾¾å›¾</span></div>
      <div class="tree-item">FeedbackButton.tsx</div>
      <div class="tree-item">BlurOverlay.tsx</div>
      <div class="tree-item">PrivacyPolicy.tsx</div>
      <div class="tree-item">theme-provider.tsx</div>
      <div class="tree-item">ğŸ“ auth/ (AuthProvider, UserDataProvider)</div>
      <div class="tree-item">ğŸ“ analytics/ (AnalyticsProvider)</div>
      <div class="tree-item">ğŸ“ layouts/ (MainLayout)</div>
      <div class="tree-item">ğŸ“ SectorRotation/ (StockSectorCard, Heatmap, Timeline)</div>
      <div class="tree-item">ğŸ“ CapitalStructure/ (ConcentrationGauge, PropagationStage)</div>
    </div>
  </div>

  <div class="tree">
    <div class="tree-toggle" onclick="toggleTree(this)">ğŸ“ hooks/ (3ä¸ªè‡ªå®šä¹‰Hook)</div>
    <div class="tree-children">
      <div class="tree-item">useTaskPolling.ts <span class="badge badge-orange">ä»»åŠ¡è½®è¯¢</span></div>
      <div class="tree-item">useStockSearch.ts <span class="badge badge-green">è‚¡ç¥¨æœç´¢</span></div>
      <div class="tree-item">useAnalytics.ts <span class="badge badge-purple">è¡Œä¸ºè¿½è¸ª</span></div>
    </div>
  </div>

  <div class="tree">
    <div class="tree-toggle" onclick="toggleTree(this)">ğŸ“ lib/ (7ä¸ªå·¥å…·æ¨¡å—)</div>
    <div class="tree-children">
      <div class="tree-item">api.ts â€” Axioså®ä¾‹ (JWTè‡ªåŠ¨æ³¨å…¥)</div>
      <div class="tree-item">supabase.ts â€” Supabaseå®¢æˆ·ç«¯</div>
      <div class="tree-item">i18n.ts â€” å›½é™…åŒ–é…ç½® (118KB,å«ç¿»è¯‘)</div>
      <div class="tree-item">stockData.ts â€” è‚¡ç¥¨æ•°æ®åº“+æ¨¡ç³Šæœç´¢ (22KB)</div>
      <div class="tree-item">analytics.ts â€” åˆ†æå·¥å…·</div>
      <div class="tree-item">historyStorage.ts â€” æœ¬åœ°å­˜å‚¨</div>
      <div class="tree-item">utils.ts â€” cn()ç­‰é€šç”¨å‡½æ•°</div>
    </div>
  </div>

  </div>
</div>

<div class="section">
  <div class="section-title">é¡µé¢â†’ç»„ä»¶æ˜ å°„ Page Components</div>
  <div class="cards" style="grid-template-columns:1fr 1fr">
    <div class="card">
      <h3 style="color:var(--green)">Home.tsx (è‚¡ç¥¨åˆ†æ)</h3>
      <div style="font-size:12px;color:var(--text2);margin-top:8px">
        â”œâ”€ StockSearchInput (æœç´¢)<br>
        â”œâ”€ PriceChart (Chart.jsæŠ˜çº¿)<br>
        â”œâ”€ KlineChart (Kçº¿èœ¡çƒ›å›¾)<br>
        â”œâ”€ Tabåˆ‡æ¢ (æŠ˜çº¿/Kçº¿)<br>
        â”œâ”€ NarrativeRadar (é›·è¾¾å›¾)<br>
        â”œâ”€ SectorRotation/* (æ¿å—ç»„ä»¶)<br>
        â”œâ”€ CapitalStructure/* (èµ„é‡‘ç»„ä»¶)<br>
        â”œâ”€ StockAnalysisHistory<br>
        â””â”€ HotRecommendations
      </div>
    </div>
    <div class="card">
      <h3 style="color:var(--blue)">Options.tsx (æœŸæƒåˆ†æ)</h3>
      <div style="font-size:12px;color:var(--text2);margin-top:8px">
        â”œâ”€ Step Wizard (æ­¥éª¤å¯¼èˆª)<br>
        â”œâ”€ MultiStockInput (å¤šæ ‡çš„è¾“å…¥)<br>
        â”œâ”€ Expiry Date Selector<br>
        â”œâ”€ Strategy Buttons (4ç­–ç•¥)<br>
        â”œâ”€ KlineChart (æ ‡çš„èµ°åŠ¿)<br>
        â”œâ”€ Option Chain Table<br>
        â”œâ”€ Option Detail Modal<br>
        â”œâ”€ Filter Panel<br>
        â””â”€ OptionsAnalysisHistory
      </div>
    </div>
  </div>
</div>
</div>

<!-- ===================== TAB 6: BACKEND ===================== -->
<div class="panel" id="panel-backend">

<div class="section">
  <div class="section-title">åç«¯åˆ†å±‚æ¶æ„ Backend Layers</div>
  <div class="arch">
    <div class="arch-layer" style="border-color:var(--teal)">
      <span class="layer-label">API Layer â€” Flask Blueprints</span>
      <div class="arch-item">stock.py<br><small style="color:var(--text2)">44KB</small></div>
      <div class="arch-item">options.py<br><small style="color:var(--text2)">28KB</small></div>
      <div class="arch-item">payment.py<br><small style="color:var(--text2)">15KB</small></div>
      <div class="arch-item">portfolio.py</div>
      <div class="arch-item">auth.py</div>
      <div class="arch-item">user.py</div>
      <div class="arch-item">+6 more</div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:var(--blue)">
      <span class="layer-label" style="color:var(--blue)">Middleware ä¸­é—´ä»¶</span>
      <div class="arch-item">@require_auth<br><small style="color:var(--text2)">JWTéªŒè¯+ç¼“å­˜(5min)</small></div>
      <div class="arch-item">@check_quota<br><small style="color:var(--text2)">æ¯æ—¥é…é¢æ£€æŸ¥</small></div>
      <div class="arch-item">@db_retry<br><small style="color:var(--text2)">æŒ‡æ•°é€€é¿é‡è¯•</small></div>
      <div class="arch-item">convert_numpy_types<br><small style="color:var(--text2)">JSONåºåˆ—åŒ–</small></div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:var(--purple)">
      <span class="layer-label" style="color:var(--purple)">Service Layer â€” Business Logic (900KB+)</span>
      <div class="arch-item" style="border-color:var(--green)">analysis_engine<br><small style="color:var(--text2)">155KB æ ¸å¿ƒå¼•æ“</small></div>
      <div class="arch-item" style="border-color:var(--blue)">options_service<br><small style="color:var(--text2)">35KB</small></div>
      <div class="arch-item" style="border-color:var(--blue)">option_scorer<br><small style="color:var(--text2)">35KB è¯„åˆ†</small></div>
      <div class="arch-item" style="border-color:var(--orange)">ai_service<br><small style="color:var(--text2)">52KB Gemini</small></div>
      <div class="arch-item" style="border-color:var(--pink)">narrative_service<br><small style="color:var(--text2)">55KB æŠ¥å‘Š</small></div>
      <div class="arch-item">payment_service<br><small style="color:var(--text2)">40KB Stripe</small></div>
      <div class="arch-item">recommendation_service<br><small style="color:var(--text2)">29KB</small></div>
      <div class="arch-item">ev_model<br><small style="color:var(--text2)">32KB ä¼°å€¼</small></div>
      <div class="arch-item">task_queue<br><small style="color:var(--text2)">27KB å¼‚æ­¥</small></div>
      <div class="arch-item">data_provider<br><small style="color:var(--text2)">11KB</small></div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:var(--orange)">
      <span class="layer-label" style="color:var(--orange)">Analysis Modules åˆ†ææ¨¡å—</span>
      <div class="arch-item">stock_analysis/core/<br><small style="color:var(--text2)">engine, fetcher, calculator</small></div>
      <div class="arch-item">stock_analysis/strategies/<br><small style="color:var(--text2)">basic strategy</small></div>
      <div class="arch-item">options_analysis/scoring/<br><small style="color:var(--text2)">sell_put, sell_call, buy_call, buy_put</small></div>
      <div class="arch-item">options_analysis/advanced/<br><small style="color:var(--text2)">vrp_calculator, trend_analyzer</small></div>
    </div>
    <div class="arch-connector"></div>
    <div class="arch-layer" style="border-color:var(--red)">
      <span class="layer-label" style="color:var(--red)">Data Layer æ•°æ®å±‚</span>
      <div class="arch-item">market_data/service.py<br><small style="color:var(--text2)">31KB Singleton</small></div>
      <div class="arch-item">market_data/cache.py<br><small style="color:var(--text2)">L1+L2ç¼“å­˜</small></div>
      <div class="arch-item">market_data/adapters/<br><small style="color:var(--text2)">5ä¸ªé€‚é…å™¨</small></div>
      <div class="arch-item">models.py<br><small style="color:var(--text2)">15+ ORMæ¨¡å‹</small></div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— Task Queue Flow</div>
  <div class="flow">
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>ğŸ“ åˆ›å»ºä»»åŠ¡</h4><p>POST /analyze</p>
      <div class="detail">APIå±‚æ¥æ”¶è¯·æ±‚ååˆ›å»ºTaskè®°å½•<br>task_type: STOCK_ANALYSIS / OPTION_ANALYSIS<br>status: PENDING<br><code>backend/app/api/stock.py:586</code></div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>ğŸ“¥ å…¥é˜Ÿ</h4><p>TaskQueue.submit()</p>
      <div class="detail">ä»»åŠ¡æ”¾å…¥å¤šçº¿ç¨‹é˜Ÿåˆ—<br>æ”¯æŒä¼˜å…ˆçº§æ’åº<br><code>backend/app/services/task_queue.py</code></div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>âš™ï¸ Workeræ‰§è¡Œ</h4><p>analysis pipeline</p>
      <div class="detail">Workerçº¿ç¨‹å–å‡ºä»»åŠ¡æ‰§è¡Œ<br>Status: PENDING â†’ RUNNING<br>æ‰§è¡Œå®Œæ•´åˆ†æç®¡é“(8æ­¥)</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>ğŸ“Š å­˜å‚¨ç»“æœ</h4><p>DB + Cache</p>
      <div class="detail">åˆ†æç»“æœå†™å…¥æ•°æ®åº“<br>Status: RUNNING â†’ COMPLETED/FAILED<br>ç»“æœç¼“å­˜è‡³å½“æ—¥Cache</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" onclick="toggleNode(this)">
      <h4>ğŸ”„ å‰ç«¯è½®è¯¢</h4><p>useTaskPolling</p>
      <div class="detail">GET /api/tasks/:id<br>è½®è¯¢é—´éš”: åŠ¨æ€è°ƒæ•´<br>è¶…æ—¶/é‡è¯•æœºåˆ¶<br><code>frontend/src/hooks/useTaskPolling.ts</code></div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">æ•°æ®åº“æ¨¡å‹ Database Models</div>
  <div class="cards" style="grid-template-columns:repeat(auto-fill,minmax(200px,1fr))">
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-purple"></span>User</h4><p>ç”¨æˆ·è¡¨ (Supabase auth_id)</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-blue"></span>Task</h4><p>å¼‚æ­¥ä»»åŠ¡ (status, result)</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-green"></span>StockAnalysisHistory</h4><p>è‚¡ç¥¨åˆ†æå†å²</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-green"></span>OptionsAnalysisHistory</h4><p>æœŸæƒåˆ†æå†å²</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-orange"></span>Subscription</h4><p>è®¢é˜… (Plus/Pro)</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-orange"></span>CreditLedger</h4><p>é¢åº¦æµæ°´</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-orange"></span>DailyQueryCount</h4><p>æ¯æ—¥æŸ¥è¯¢è®¡æ•°</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-orange"></span>Payment</h4><p>æ”¯ä»˜è®°å½•</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-teal"></span>Portfolio</h4><p>æŠ•èµ„ç»„åˆ</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-teal"></span>PortfolioHolding</h4><p>æŒä»“æ˜ç»†</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-pink"></span>Feedback</h4><p>ç”¨æˆ·åé¦ˆ</p></div>
    <div class="card" style="padding:14px"><h4 style="font-size:13px"><span class="dot dot-pink"></span>AnalyticsEvent</h4><p>è¡Œä¸ºäº‹ä»¶</p></div>
  </div>
</div>

<div class="section">
  <div class="section-title">å®šæ—¶ä»»åŠ¡ Scheduler (APScheduler)</div>
  <table class="tbl">
    <tr><th>ä»»åŠ¡</th><th>é¢‘ç‡</th><th>è¯´æ˜</th><th>æ–‡ä»¶</th></tr>
    <tr><td>æ¯æ—¥æ¨èç”Ÿæˆ</td><td>æ¯å¤©</td><td>ç”Ÿæˆçƒ­é—¨è‚¡ç¥¨/æœŸæƒæ¨è</td><td>scheduler.py</td></tr>
    <tr><td>é£ä¹¦æŠ¥å‘Š</td><td>æ¯å¤©</td><td>_send_feishu_report() å‘é€è¿è¥æ•°æ®</td><td>scheduler.py:249</td></tr>
    <tr><td>å¥åº·æ£€æŸ¥</td><td>å®šæ—¶</td><td>Providerå¥åº·çŠ¶æ€ç›‘æ§</td><td>market_data/service.py</td></tr>
    <tr><td>ç¼“å­˜æ¸…ç†</td><td>å®šæ—¶</td><td>è¿‡æœŸç¼“å­˜æ¸…é™¤</td><td>market_data/cache.py</td></tr>
  </table>
</div>

<div class="section">
  <div class="section-title">è®¢é˜…ç³»ç»Ÿ Subscription</div>
  <div class="cards" style="grid-template-columns:repeat(3,1fr)">
    <div class="card" style="border-top:3px solid var(--text2)">
      <h3>Free å…è´¹ç‰ˆ</h3>
      <div style="font-size:28px;font-weight:700;color:var(--text2);margin:12px 0">$0</div>
      <p>æ¯æ—¥ 10 æ¬¡æŸ¥è¯¢</p>
    </div>
    <div class="card" style="border-top:3px solid var(--teal)">
      <h3>Plus</h3>
      <div style="font-size:28px;font-weight:700;color:var(--teal);margin:12px 0">$58.80<small style="font-size:14px">/æœˆ</small></div>
      <p>æ¯æœˆ 1000 Credits<br>å¹´ä»˜ $588/å¹´</p>
    </div>
    <div class="card" style="border-top:3px solid var(--purple)">
      <h3>Pro</h3>
      <div style="font-size:28px;font-weight:700;color:var(--purple);margin:12px 0">$99.80<small style="font-size:14px">/æœˆ</small></div>
      <p>æ¯æœˆ 5000 Credits<br>å¹´ä»˜ $998/å¹´</p>
    </div>
  </div>
</div>

</div>
</div>

<!-- Search results overlay -->
<div id="searchResults" style="display:none;position:fixed;top:60px;right:32px;width:400px;max-height:500px;overflow-y:auto;background:var(--bg2);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);z-index:200;padding:12px">
  <div id="searchResultsList"></div>
</div>

<script>
// Tab switching
function switchTab(tabId){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
  document.getElementById('panel-'+tabId).classList.add('active');
}
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click',()=>switchTab(tab.dataset.tab));
});

// Flow node toggle
function toggleNode(el){
  const wasExpanded=el.classList.contains('expanded');
  el.parentElement.querySelectorAll('.flow-node').forEach(n=>n.classList.remove('expanded'));
  if(!wasExpanded)el.classList.add('expanded');
}

// Pipeline toggle
function togglePipe(el){
  const wasActive=el.classList.contains('active');
  document.querySelectorAll('.pipe-step').forEach(s=>s.classList.remove('active'));
  if(!wasActive)el.classList.add('active');
}

// Collapse toggle
function toggleCollapse(el){
  el.classList.toggle('open');
}

// Tree toggle
function toggleTree(el){
  el.classList.toggle('open');
}

// Wizard detail
const wizardDetails={
  1:'<h3>Step 1: é€‰æ‹©æ ‡çš„</h3><p style="margin:8px 0;font-size:13px;color:var(--text2)"><strong>ç»„ä»¶:</strong> MultiStockInput (æœ€å¤š3ä¸ª)<br><code style="color:var(--teal)">frontend/src/components/ui/MultiStockInput.tsx</code><br><br>æ”¯æŒ: US(AAPL), HK(0700), Aè‚¡(600519)<br>è‡ªåŠ¨è¡¥å…¨ + æ‹¼éŸ³æœç´¢</p>',
  2:'<h3>Step 2: åŠ è½½åˆ°æœŸæ—¥</h3><p style="margin:8px 0;font-size:13px;color:var(--text2)"><strong>API:</strong> GET /api/options/expirations/{symbol}<br><code style="color:var(--teal)">backend/app/api/options.py:164</code><br><br>è¿”å›åˆ°æœŸæ—¥åˆ—è¡¨ + period_tag (d/w/m)<br>d=æ—¥åº¦, w=å‘¨åº¦, m=æœˆåº¦</p>',
  3:'<h3>Step 3: é€‰æ‹©åˆ°æœŸæ—¥</h3><p style="margin:8px 0;font-size:13px;color:var(--text2)">æ”¯æŒå¤šåˆ°æœŸæ—¥ (æœ€å¤š2ä¸ª)<br>æŒ‰å‘¨æœŸè¿‡æ»¤: è¿‘æœŸ/å‘¨åº¦/æœˆåº¦<br>State: selectedExpiries[]</p>',
  4:'<h3>Step 4: é€‰æ‹©ç­–ç•¥</h3><p style="margin:8px 0;font-size:13px;color:var(--text2)"><strong>4ç§ç­–ç•¥:</strong><br>â€¢ <span style="color:var(--green)">Sell Put</span> â€” å–å‡ºè®¤æ²½ (ç¨³å¥æ”¶ç§Ÿ)<br>â€¢ <span style="color:var(--blue)">Sell Call</span> â€” å–å‡ºè®¤è´­ (é«˜ä½æ”¶å‰²)<br>â€¢ <span style="color:var(--orange)">Buy Call</span> â€” ä¹°å…¥è®¤è´­ (çœ‹æ¶¨æ æ†)<br>â€¢ <span style="color:var(--red)">Buy Put</span> â€” ä¹°å…¥è®¤æ²½ (çœ‹è·Œå¯¹å†²)</p>',
  5:'<h3>Step 5: æ‰§è¡Œåˆ†æ</h3><p style="margin:8px 0;font-size:13px;color:var(--text2)"><strong>API:</strong> POST /api/options/chain-async<br><code style="color:var(--teal)">backend/app/api/options.py:50</code><br><br>åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ â†’ åç«¯è·å–æœŸæƒé“¾ â†’ 4ç­–ç•¥è¯„åˆ† â†’ è¿”å›Top10<br>å‰ç«¯: useTaskPolling å®æ—¶è½®è¯¢è¿›åº¦</p>',
  6:'<h3>Step 6: ç»“æœå±•ç¤º</h3><p style="margin:8px 0;font-size:13px;color:var(--text2)"><strong>å±•ç¤º:</strong><br>â€¢ Calls/Puts åŒè¡¨æ ¼<br>â€¢ è¡Œæƒä»· | ä»·æ ¼ | Bid/Ask | IV | Greeks | è¯„åˆ†<br>â€¢ ç‚¹å‡»è¡Œ â†’ è¯¦æƒ…å¼¹çª— (Greeks + é£æ§ + ç­–ç•¥å»ºè®®)<br>â€¢ è¿‡æ»¤: è¡Œæƒä»·/æ”¶ç›Šç‡/é£é™©åå¥½<br>â€¢ æ’åº: è¯„åˆ†/Delta/IVç­‰<br>â€¢ é¢œè‰²: 70+ ç»¿ / 50-69 é»„ / <50 çº¢</p>'
};
function showWizardDetail(step){
  document.querySelectorAll('.wizard-dot').forEach(d=>d.classList.remove('active'));
  document.querySelectorAll('.wizard-dot')[step-1].classList.add('active');
  document.getElementById('wizardDetail').innerHTML='<div class="card">'+wizardDetails[step]+'</div>';
}

// Search
const searchData=[
  {t:'StockSearchInput',d:'è‚¡ç¥¨æœç´¢ç»„ä»¶',tab:'frontend',k:'search stock input component'},
  {t:'MultiStockInput',d:'å¤šæ ‡çš„è¾“å…¥ç»„ä»¶',tab:'frontend',k:'multi stock input'},
  {t:'KlineChart',d:'Kçº¿èœ¡çƒ›å›¾ (Lightweight Charts)',tab:'frontend',k:'kline chart candlestick'},
  {t:'Home.tsx',d:'è‚¡ç¥¨åˆ†æé¡µé¢',tab:'stock',k:'home stock analysis page'},
  {t:'Options.tsx',d:'æœŸæƒåˆ†æé¡µé¢',tab:'options',k:'options analysis page'},
  {t:'useTaskPolling',d:'å¼‚æ­¥ä»»åŠ¡è½®è¯¢Hook',tab:'frontend',k:'task polling hook async'},
  {t:'useStockSearch',d:'è‚¡ç¥¨æœç´¢Hook',tab:'frontend',k:'stock search hook'},
  {t:'AuthProvider',d:'Supabase JWTè®¤è¯',tab:'frontend',k:'auth provider jwt supabase'},
  {t:'UserDataProvider',d:'ç”¨æˆ·æ•°æ®Context',tab:'frontend',k:'user data provider context'},
  {t:'ThemeProvider',d:'æš—è‰²/äº®è‰²ä¸»é¢˜',tab:'frontend',k:'theme provider dark light'},
  {t:'/api/stock/analyze',d:'è‚¡ç¥¨åˆ†æAPI (å¼‚æ­¥)',tab:'datasource',k:'stock analyze api endpoint'},
  {t:'/api/stock/search',d:'è‚¡ç¥¨æ¨¡ç³Šæœç´¢API',tab:'datasource',k:'stock search api fuzzy'},
  {t:'/api/options/chain-async',d:'æœŸæƒé“¾åˆ†æAPI',tab:'datasource',k:'options chain async api'},
  {t:'/api/options/expirations',d:'æœŸæƒåˆ°æœŸæ—¥API',tab:'datasource',k:'options expirations api'},
  {t:'/api/payment/webhook',d:'Stripeå›è°ƒ',tab:'datasource',k:'payment stripe webhook'},
  {t:'analysis_engine.py',d:'æ ¸å¿ƒåˆ†æå¼•æ“ (155KB)',tab:'backend',k:'analysis engine core'},
  {t:'ai_service.py',d:'Gemini AIæœåŠ¡ (52KB)',tab:'backend',k:'ai service gemini google'},
  {t:'options_service.py',d:'æœŸæƒä¸šåŠ¡é€»è¾‘ (35KB)',tab:'backend',k:'options service business'},
  {t:'option_scorer.py',d:'4ç­–ç•¥è¯„åˆ†å¼•æ“ (35KB)',tab:'backend',k:'option scorer strategy'},
  {t:'task_queue.py',d:'å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—',tab:'backend',k:'task queue async worker'},
  {t:'MarketDataService',d:'å¤šæºæ•°æ®æœåŠ¡ (Singleton)',tab:'datasource',k:'market data service singleton'},
  {t:'YFinance',d:'ä¸»è¦æ•°æ®æº (å…è´¹)',tab:'datasource',k:'yfinance yahoo finance primary'},
  {t:'Tiger API',d:'æœŸæƒ+æ¸¯è‚¡æ•°æ®',tab:'datasource',k:'tiger api options hk'},
  {t:'Tushare',d:'Aè‚¡æ•°æ®æº',tab:'datasource',k:'tushare a-share china'},
  {t:'Alpha Vantage',d:'æŠ€æœ¯åˆ†ææ•°æ®',tab:'datasource',k:'alpha vantage technical'},
  {t:'Sell Put (SPRV)',d:'å–å‡ºè®¤æ²½è¯„åˆ†',tab:'options',k:'sell put sprv score strategy'},
  {t:'Buy Call (BCRV)',d:'ä¹°å…¥è®¤è´­è¯„åˆ†',tab:'options',k:'buy call bcrv score strategy'},
  {t:'G = B + M',d:'æ ¸å¿ƒæ¨¡å‹: Gain = Basics + Momentum',tab:'stock',k:'gbm model gain basics momentum'},
  {t:'ATRæ­¢æŸ',d:'åŠ¨æ€æ­¢æŸè®¡ç®—',tab:'stock',k:'atr stop loss dynamic'},
  {t:'EVæ¨¡å‹',d:'æœŸæœ›ä»·å€¼æ¨¡å‹',tab:'stock',k:'ev model expected value'},
  {t:'Black-Scholes',d:'æœŸæƒå®šä»·å…¬å¼',tab:'options',k:'black scholes formula pricing'},
  {t:'VRP',d:'æ³¢åŠ¨ç‡é£é™©æº¢ä»·',tab:'options',k:'vrp volatility risk premium'},
  {t:'models.py',d:'SQLAlchemy ORMæ¨¡å‹',tab:'backend',k:'models database sqlalchemy orm'},
  {t:'scheduler.py',d:'å®šæ—¶ä»»åŠ¡ (APScheduler)',tab:'backend',k:'scheduler apscheduler cron'},
  {t:'Subscription',d:'è®¢é˜…ç³»ç»Ÿ (Plus/Pro)',tab:'backend',k:'subscription plus pro pricing'},
  {t:'_send_feishu_report',d:'é£ä¹¦æ¯æ—¥æŠ¥å‘Š',tab:'backend',k:'feishu report daily notification'},
  {t:'data_provider.py',d:'æ•°æ®æä¾›è€…æŠ½è±¡å±‚',tab:'datasource',k:'data provider abstraction'},
  {t:'narrative_service.py',d:'AIå™è¿°æŠ¥å‘Šç”Ÿæˆ (55KB)',tab:'backend',k:'narrative service report ai'},
  {t:'ev_model.py',d:'EVä¼°å€¼æ¨¡å‹ (32KB)',tab:'backend',k:'ev model valuation'},
  {t:'payment_service.py',d:'Stripeæ”¯ä»˜ (40KB)',tab:'backend',k:'payment service stripe'},
  {t:'recommendation_service.py',d:'æ¯æ—¥æ¨è (29KB)',tab:'backend',k:'recommendation service daily hot'},
];

const searchBox=document.getElementById('searchBox');
const searchResults=document.getElementById('searchResults');
const searchResultsList=document.getElementById('searchResultsList');

searchBox.addEventListener('input',function(){
  const q=this.value.toLowerCase().trim();
  if(!q){searchResults.style.display='none';return;}
  const matches=searchData.filter(i=>i.t.toLowerCase().includes(q)||i.d.includes(q)||i.k.includes(q));
  if(!matches.length){searchResults.style.display='none';return;}
  searchResults.style.display='block';
  searchResultsList.innerHTML=matches.slice(0,12).map(m=>
    `<div style="padding:10px;cursor:pointer;border-bottom:1px solid var(--border);font-size:13px" onclick="switchTab('${m.tab}');searchResults.style.display='none';searchBox.value='';" onmouseover="this.style.background='var(--bg3)'" onmouseout="this.style.background='transparent'">
      <div style="font-weight:600">${m.t}</div>
      <div style="font-size:11px;color:var(--text2)">${m.d} <span class="badge badge-teal">${m.tab}</span></div>
    </div>`
  ).join('');
});

// Ctrl+K focus search
document.addEventListener('keydown',function(e){
  if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();searchBox.focus();}
  if(e.key==='Escape'){searchResults.style.display='none';searchBox.blur();}
});

// Click outside to close search
document.addEventListener('click',function(e){
  if(!searchBox.contains(e.target)&&!searchResults.contains(e.target)){
    searchResults.style.display='none';
  }
});
</script>

</body>
</html>
