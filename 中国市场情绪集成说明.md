# 中国市场情绪数据集成说明

## 📊 功能概述

为了解决系统在分析A股/港股时的"半盲"状态，我们集成了 **AkShare** 库来获取中国市场特有的情绪数据。

## ✅ 已实现功能

### 1. 数据源集成

**文件**: `china_sentiment.py`

- ✅ **个股新闻**（东方财富）：获取最新政策和舆情
- ✅ **主力资金流向**：识别主力/散户资金净流入/流出
- ✅ **龙虎榜数据**：识别游资炒作热度（投机情绪）
- ✅ **宏观政策信号**（财联社）：获取政策风向标
- ✅ **关键词提取**：自动识别政策关键词（国务院、央行、证监会等）

### 2. 情绪评分计算

**函数**: `calculate_china_sentiment_score()`

根据中国市场特点计算情绪分数：
- **主力资金流向**：大幅净流入/流出影响±1.5-2.0分
- **政策信号**：政策面利好/利空影响±2.0分（权重最高）
- **龙虎榜数据**：游资炒作影响±1.0-1.5分
- **新闻关键词**：正面/负面关键词影响±0.5分

### 3. 集成到主流程

**文件**: `analysis_engine.py` - `calculate_market_sentiment()`

- ✅ 自动检测A股/港股（`.SS`, `.SZ`, `.HK`后缀）
- ✅ 对于A股/港股，获取中国市场特有情绪数据
- ✅ 中国市场情绪权重：**40%**（政策>一切）
- ✅ 混合计算：60%传统指标 + 40%中国市场指标

### 4. AI Prompt优化

**文件**: `ai_service.py` - `get_gemini_analysis()`

- ✅ 针对A股/港股添加专门的"中国市场特有情绪面"章节
- ✅ 包含最新政策与舆情、主力资金流向、龙虎榜数据、宏观政策风向
- ✅ 提示AI：**政策面权重 > 基本面权重**（中国市场核心特征）
- ✅ 关键词触发器说明（"印发"、"规划"、"立案调查"等）

## 🎯 核心策略

### 中国市场G=B+M模型的权重调整

对于A股/港股，**M（情绪）模块**的权重调整为：
- **政策 > 一切** (Policy is King)
- **主力资金流向** > 散户情绪
- **北向资金** = "聪明钱"指标

### 算法优化建议

1. **政策关键词触发器**：
   - 如果新闻标题包含 "印发"、"规划"、"立案调查"
   - 直接给M分数加减2-3分

2. **北向资金信号**：
   - 如果大盘跌，但北向资金连续3天净买入
   - → 强力买入信号（往往是底部）

3. **避开"杀猪盘"**：
   - 如果股吧/雪球讨论热度暴增，但无实质性新闻
   - → 警惕信号（可能是庄家出货）

## 📦 依赖安装

```bash
pip install akshare
```

已在 `requirements.txt` 中添加。

## 🔧 配置说明

### AkShare接口说明

**注意**：AkShare的接口可能会更新，如果遇到接口错误，请：

1. 更新AkShare到最新版本：
   ```bash
   pip install --upgrade akshare
   ```

2. 查看AkShare文档：https://akshare.readthedocs.io/

3. 根据最新文档调整 `china_sentiment.py` 中的接口调用

### 当前使用的接口

- `ak.stock_news_em()` - 获取个股新闻
- `ak.stock_individual_fund_flow_rank()` - 获取资金流向
- `ak.stock_lhb_detail_em()` - 获取龙虎榜数据
- `ak.stock_telegraph_cls()` - 获取财联社电报

## 📝 数据返回结构

### `china_sentiment` 字段

```python
{
    'latest_news': [...],           # 最新新闻列表
    'main_net_inflow': 0,           # 主力净流入（元）
    'retail_net_inflow': 0,         # 散户净流入（元）
    'dragon_tiger_list': {...},     # 龙虎榜数据
    'news_keywords': [...],         # 新闻关键词
    'market_type': 'CN'             # 市场类型
}
```

### `china_policy` 字段

```python
{
    'important_news': [...],        # 重要新闻列表
    'policy_keywords': [...],       # 政策关键词
    'market_impact': 'neutral'      # 市场影响：positive/negative/neutral
}
```

## 🚀 使用示例

系统会自动检测A股/港股并应用中国市场情绪分析：

```python
# A股示例
ticker = "600519.SS"  # 贵州茅台
# 系统会自动：
# 1. 获取最新政策和新闻
# 2. 获取主力资金流向
# 3. 检查是否上龙虎榜
# 4. 分析宏观政策风向
# 5. 计算中国市场特有的情绪分数（权重40%）

# 港股示例
ticker = "00700.HK"  # 腾讯控股
# 系统会自动应用港股特有的分析逻辑
```

## ⚠️ 注意事项

1. **AkShare接口稳定性**：
   - AkShare是开源库，接口可能不定期更新
   - 如果数据获取失败，系统会继续使用传统指标，不会中断分析

2. **数据延迟**：
   - 部分数据可能有延迟（如龙虎榜数据通常是T+1日更新）
   - 建议结合实时数据源使用

3. **网络连接**：
   - 需要访问国内数据源，确保网络连接正常
   - 如果无法访问，会回退到传统分析

## 🔄 后续优化方向

1. **北向资金数据**：
   - 实现完整的北向资金流向分析
   - 作为"聪明钱"指标

2. **雪球/股吧热度**：
   - 获取雪球热帖和股吧讨论热度
   - 作为散户情绪反向指标

3. **南向资金数据**：
   - 港股专用：南向资金（大陆资金买港股）分析

## 📚 参考资料

- [AkShare官方文档](https://akshare.readthedocs.io/)
- [AkShare GitHub](https://github.com/akfamily/akshare)

---

**版本**: v1.0  
**最后更新**: 2025-12  
**作者**: minmin





