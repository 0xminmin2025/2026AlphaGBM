<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpha GBM - 基于 Gemini AI 的智能股票分析</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Phosphor Icons (for icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Chart.js for stock chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+SC:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        /* ==================== Alpha GBM 设计系统 ==================== */

        :root {
            /* 品牌色 - 深青色 */
            --brand-primary: #0D9B97;
            --brand-primary-rgb: 13, 155, 151;
            --brand-primary-light: #10B5B0;
            --brand-primary-dark: #0A7D7A;

            /* 背景色 */
            --bg-primary: #09090B;
            --bg-secondary: #18181B;
            --bg-tertiary: #27272A;

            /* 文字色 */
            --text-primary: #FAFAFA;
            --text-secondary: #A1A1AA;
            --text-muted: #71717A;

            /* 金融色 */
            --color-bull: #10B981;
            --color-bear: #EF4444;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* 渐变文字 - 使用品牌色 */
        .gradient-text {
            background: linear-gradient(to right, var(--brand-primary), var(--brand-primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* 玻璃卡片效果 */
        .glass-card {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(39, 39, 42, 0.8);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            border-color: rgba(13, 155, 151, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px -10px rgba(13, 155, 151, 0.3);
        }

        /* 英雄区光晕 - 使用品牌色 */
        .hero-glow {
            position: absolute;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(13, 155, 151, 0.15) 0%, rgba(9, 9, 11, 0) 70%);
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 0;
            pointer-events: none;
        }

        /* Beta 徽章脉冲动画 */
        .beta-pulse {
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 0 0 rgba(13, 155, 151, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(13, 155, 151, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(13, 155, 151, 0);
            }
        }

        /* 导航栏优化 */
        nav {
            background: rgba(9, 9, 11, 0.8) !important;
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(39, 39, 42, 0.8);
        }

        /* 按钮优化 */
        .btn-primary {
            background-color: var(--brand-primary) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(13, 155, 151, 0.3);
        }

        .btn-primary:hover {
            background-color: var(--brand-primary-light) !important;
            box-shadow: 0 4px 8px rgba(13, 155, 151, 0.4);
        }

        /* 品牌色工具类 - 替代 cyan */
        .text-brand {
            color: var(--brand-primary) !important;
        }

        .bg-brand {
            background-color: var(--brand-primary) !important;
        }

        .bg-brand\/5 {
            background-color: rgba(13, 155, 151, 0.05) !important;
        }

        .bg-brand\/10 {
            background-color: rgba(13, 155, 151, 0.1) !important;
        }

        .border-brand {
            border-color: var(--brand-primary) !important;
        }

        .border-brand\/10 {
            border-color: rgba(13, 155, 151, 0.1) !important;
        }

        .hover\:text-brand:hover {
            color: var(--brand-primary) !important;
        }

        .hover\:bg-brand:hover {
            background-color: var(--brand-primary) !important;
        }

        .shadow-brand {
            box-shadow: 0 0 20px rgba(13, 155, 151, 0.3);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Content Data
        const content = {
            zh: {
                nav: {
                    home: "首页",
                    portfolio: "实盘追踪",
                    styles: "模型理念",
                    download: "关注我们",
                    cta: "立即体验",
                    lang: "EN"
                },
                portfolio: {
                    title: "四大风格投资组合实盘追踪",
                    description: "四种投资风格组合（质量、价值、成长、趋势），每个组合 25 万美元，共 100 万美元实盘追踪", // 对比标普500、纳斯达克指数、恒生指数、沪深300表现
                    quality: "质量组合",
                    value: "价值组合",
                    growth: "成长组合",
                    momentum: "趋势组合",
                    sp500: "标普500",
                    nasdaq: "纳斯达克",
                    hsi: "恒生指数",
                    csi300: "沪深300",
                    performanceChart: "累计收益走势图",
                    summary: "组合表现总结",
                    totalReturn: "总收益率",
                    dailyChange: "今日变化",
                    maxDrawdown: "最大回撤",
                    sharpeRatio: "夏普比率",
                    startDate: "起始日期",
                    initialCapital: "初始资金",
                    holdings: "持仓明细",
                    viewHoldings: "查看持仓",
                    hideHoldings: "收起持仓",
                    stock: "股票",
                    shares: "持仓股数",
                    costPrice: "成本价",
                    currentPrice: "当前价",
                    allocation: "占比",
                    profit: "盈利",
                    profitPercent: "收益率"
                },
                hero: {
                    badge: "Powered by LLM",
                    title: "以AI重构股价逻辑",
                    titleHighlight: "",
                    subtitle: "基于自研投资模型，不预测未来，只计算概率，智能识别市场标的，提供机构级风控建议",
                    cta_primary: "立即体验",
                    cta_secondary: "了解模型",
                    limit_notice: "每位注册用户每日限额 5 次",
                    demo_card: {
                        ticker: "AAPL (苹果公司)",
                        style_label: "策略风格",
                        style_val: "质量策略",
                        risk_label: "风险评分",
                        risk_val: "2.5 / 10 (低风险)",
                        g_label: "P-价格",
                        g_val: "高位",
                        b_label: "F-基本面",
                        b_val: "强劲",
                        m_label: "S-情绪",
                        m_val: "中性",
                        ai_verdict: "AI 分析结论：基本面 (F) 支撑强劲，虽然价格 (P) 处于高位，但市场情绪 (S) 稳定。建议仓位",
                        ai_pos: "18%"
                    }
                },
                model: {
                    title: "G = B + M",
                    desc: "将混沌的市场波动解构为极简的数学逻辑",
                    g: { title: "G (收益)", desc: "收益偏离度与技术形态" },
                    b: { title: "B (基本面)", desc: "营收、利润与估值锚点" },
                    m: { title: "M (动量)", desc: "恐慌指数与宏观因子" }
                },
                features: {
                    title: "全维度智能分析",
                    items: [
                        { icon: "Brain", title: "AI 深度决策", desc: "集成 Google Gemini AI，自动生成包含风格判定、五大支柱检查的深度研报。" },
                        { icon: "ShieldWarning", title: "风险量化系统", desc: "0-10 分动态风险评级，结合 VIX 与 Put/Call 比率，精准识别危险信号。" },
                        { icon: "ChartPie", title: "智能仓位管理", desc: "拒绝盲目博弈。根据风险等级动态计算最优仓位，严格执行资金管理。" },
                        { icon: "Globe", title: "全市场覆盖", desc: "无缝支持美股、港股、A股代码自动识别，打破市场信息壁垒。" }
                    ]
                },
                styles: {
                    title: "投资理念与四大风格",
                    desc: "基于G=B+M模型，系统自动适配您的投资风格",
                    cards: [
                        { name: "质量策略", color: "text-emerald-400", desc: "护城河深、财务稳健。适合长期持有。" },
                        { name: "价值策略", color: "text-blue-400", desc: "低估值、安全边际。寻找错杀机会。" },
                        { name: "成长策略", color: "text-purple-400", desc: "高营收增速。容忍高估值换取成长。" },
                        { name: "趋势策略", color: "text-orange-400", desc: "价格动量驱动。快进快出跟随趋势。" }
                    ]
                },
                cta: {
                    title: "加入 Alpha GBM 社区",
                    desc: "获取内测资格、最新模型更新及深度投资策略。",
                    scan_text: "扫码关注公众号体验"
                },
                footer: {
                    disclaimer: "免责声明：本系统仅供学习和研究使用，不构成任何投资建议。投资有风险，入市需谨慎。",
                    copy: "© 2025 Alpha GBM. 基于 G=B+M 投资框架"
                }
            },
            en: {
                nav: {
                    home: "Home",
                    portfolio: "Live Tracking",
                    styles: "Model Philosophy",
                    download: "Follow Us",
                    cta: "Try Now",
                    lang: "中"
                },
                portfolio: {
                    title: "Four-Style Portfolio Live Tracking",
                    description: "Four investment style portfolios (Quality, Value, Growth, Momentum), each with $250K, total $1M live tracking vs S&P 500, NASDAQ, Hang Seng Index & CSI 300",
                    quality: "Quality Portfolio",
                    value: "Value Portfolio",
                    growth: "Growth Portfolio",
                    momentum: "Momentum Portfolio",
                    sp500: "S&P 500",
                    nasdaq: "NASDAQ",
                    hsi: "Hang Seng",
                    csi300: "CSI 300",
                    performanceChart: "Cumulative Return",
                    summary: "Performance Summary",
                    totalReturn: "Total Return",
                    dailyChange: "Daily Change",
                    maxDrawdown: "Max Drawdown",
                    sharpeRatio: "Sharpe Ratio",
                    startDate: "Start Date",
                    initialCapital: "Initial Capital",
                    holdings: "Holdings Detail",
                    viewHoldings: "View Holdings",
                    hideHoldings: "Hide Holdings",
                    stock: "Stock",
                    shares: "Shares",
                    costPrice: "Cost",
                    currentPrice: "Current",
                    allocation: "Weight",
                    profit: "Profit",
                    profitPercent: "Return"
                },
                hero: {
                    badge: "Powered by LLM",
                    title: "AI-Powered Stock Price Logic",
                    titleHighlight: "",
                    subtitle: "Based on proprietary Model. We don't predict the future; we calculate probabilities. Intelligently identify market opportunities with institutional-grade risk management.",
                    cta_primary: "Try Now",
                    cta_secondary: "Learn More",
                    limit_notice: "5 queries per day for registered users",
                    demo_card: {
                        ticker: "AAPL (Apple Inc.)",
                        style_label: "STYLE",
                        style_val: "QUALITY",
                        risk_label: "Risk Score",
                        risk_val: "2.5 / 10 (Low)",
                        g_label: "P-Score",
                        g_val: "High",
                        b_label: "F-Score",
                        b_val: "Strong",
                        m_label: "S-Score",
                        m_val: "Neutral",
                        ai_verdict: "AI Verdict: Strong fundamentals (F) justify price (P). Sentiment (S) is neutral. Suggested Position:",
                        ai_pos: "18%"
                    }
                },
                model: {
                    title: "G = B + M",
                    desc: "Deconstructing chaos into mathematical logic",
                    g: { title: "G (Gain)", desc: "Gain Deviation & Technicals" },
                    b: { title: "B (Basics)", desc: "Fundamental Support" },
                    m: { title: "M (Momentum)", desc: "Momentum & Macro Factors" }
                },
                features: {
                    title: "Full-Dimension Analysis",
                    items: [
                        { icon: "Brain", title: "AI Deep Decision", desc: "Integrated Gemini AI generates deep reports with 5-Pillar checks and strategy analysis." },
                        { icon: "ShieldWarning", title: "Risk Quant", desc: "0-10 dynamic risk rating based on VIX, Put/Call ratios, and macro indicators." },
                        { icon: "ChartPie", title: "Position Sizing", desc: "Stop blind betting. Get calculated position suggestions based on risk levels." },
                        { icon: "Globe", title: "Global Coverage", desc: "Seamless support for US, HK, and A-Shares. Breaking information barriers." }
                    ]
                },
                styles: {
                    title: "Model Philosophy & 4 Styles",
                    desc: "Based on G=B+M Model, adapting to your investment style",
                    cards: [
                        { name: "Quality", color: "text-emerald-400", desc: "Wide moat, strong financials. Long-term." },
                        { name: "Value", color: "text-blue-400", desc: "Undervalued, safety margin. Mid-term." },
                        { name: "Growth", color: "text-purple-400", desc: "High revenue growth. High risk tolerance." },
                        { name: "Momentum", color: "text-orange-400", desc: "Price action driven. Short-term trading." }
                    ]
                },
                cta: {
                    title: "Join Alpha GBM Community",
                    desc: "Get Beta access, model updates, and deep strategies.",
                    scan_text: "Scan to Follow"
                },
                footer: {
                    disclaimer: "Disclaimer: This system is for educational purposes only and does not constitute investment advice.",
                    copy: "© 2025 Alpha GBM. Based on G=B+M Investment Framework"
                }
            }
        };

        const App = () => {
            const [lang, setLang] = useState('zh');
            const [stockData, setStockData] = useState(null);
            const [chart, setChart] = useState(null);
            const [buyPoints, setBuyPoints] = useState([]);
            const [currentPrice, setCurrentPrice] = useState('');
            const [maxReturn, setMaxReturn] = useState('');
            const [aiPosition, setAiPosition] = useState('');
            const [expandedPortfolio, setExpandedPortfolio] = useState(null);
            const t = content[lang];

            const toggleLang = () => setLang(lang === 'zh' ? 'en' : 'zh');

            // 四个组合的持仓数据 - 使用React状态管理
            const [portfolioHoldings, setPortfolioHoldings] = useState({
                quality: [],
                value: [],
                growth: [],
                momentum: []
            });

            // 存储各投资风格的盈亏数据
            const [styleStats, setStyleStats] = useState({
                quality: { profitLossPercent: '0', vsYesterdayPercent: '0' },
                value: { profitLossPercent: '0', vsYesterdayPercent: '0' },
                growth: { profitLossPercent: '0', vsYesterdayPercent: '0' },
                momentum: { profitLossPercent: '0', vsYesterdayPercent: '0' }
            });

            // 默认后备数据
            const defaultPortfolioData = {
                quality: [
                    { ticker: 'NVDA', name: '英伟达', shares: 214, cost: 194.2, current: 194.2, market: 'US' },
                    { ticker: 'GOOGL', name: '谷歌', shares: 157, cost: 263.8, current: 263.8, market: 'US' },
                    { ticker: '9988.HK', name: '阿里巴巴', shares: 1917, cost: 169.5, current: 169.5, market: 'HK' },
                    { ticker: '0700.HK', name: '腾讯控股', shares: 505, cost: 642.6, current: 642.6, market: 'HK' },
                    { ticker: '600276', name: '恒瑞医药', shares: 4405, cost: 67.15, current: 67.15, market: 'CN' },
                    { ticker: '300750', name: '宁德时代', shares: 759, cost: 389.56, current: 389.56, market: 'CN' }
                ],
                value: [
                    { ticker: 'COP', name: '康菲石油', shares: 462, cost: 90.03, current: 90.03, market: 'US' },
                    { ticker: 'PFE', name: '辉瑞', shares: 1635, cost: 25.47, current: 25.47, market: 'US' },
                    { ticker: '0883.HK', name: '中国海油', shares: 16839, cost: 19.3, current: 19.3, market: 'HK' },
                    { ticker: '1378.HK', name: '中国宏桥', shares: 11926, cost: 27.25, current: 27.25, market: 'HK' },
                    { ticker: '600900', name: '长江电力', shares: 8000, cost: 22.50, current: 22.50, market: 'CN' },
                    { ticker: '600028', name: '中国石化', shares: 25000, cost: 5.20, current: 5.20, market: 'CN' }
                ],
                growth: [
                    { ticker: 'MU', name: '美光科技', shares: 550, cost: 88.00, current: 88.00, market: 'US' },
                    { ticker: 'PLTR', name: 'Palantir', shares: 1200, cost: 35.00, current: 35.00, market: 'US' },
                    { ticker: '9961.HK', name: '携程集团', shares: 1000, cost: 280.00, current: 280.00, market: 'HK' },
                    { ticker: '2577.HK', name: '英诺赛科', shares: 3000, cost: 32.50, current: 32.50, market: 'HK' },
                    { ticker: '603986', name: '兆易创新', shares: 2000, cost: 115.00, current: 115.00, market: 'CN' },
                    { ticker: '688386', name: '泛亚微透', shares: 1500, cost: 55.00, current: 55.00, market: 'CN' }
                ],
                momentum: [
                    { ticker: 'TSLA', name: '特斯拉', shares: 200, cost: 245.00, current: 245.00, market: 'US' },
                    { ticker: 'MU', name: '美光科技', shares: 400, cost: 92.00, current: 92.00, market: 'US' },
                    { ticker: '0981.HK', name: '中芯国际', shares: 5000, cost: 15.80, current: 15.80, market: 'HK' },
                    { ticker: '9992.HK', name: '泡泡玛特', shares: 2000, cost: 42.50, current: 42.50, market: 'HK' },
                    { ticker: '002371', name: '北方华创', shares: 800, cost: 218.00, current: 218.00, market: 'CN' },
                    { ticker: '688256', name: '寒武纪', shares: 1200, cost: 125.00, current: 125.00, market: 'CN' }
                ]
            };

            // 从API获取持仓数据
            async function fetchPortfolioData() {
                try {
                    const response = await fetch('https://alphagbm.com/api/portfolio/holdings');
                    const data = await response.json();

                    if (data.success) {
                        // 保存风格统计数据
                        if (data.portfolio.styleStats) {
                            setStyleStats(data.portfolio.styleStats);
                            console.log('风格统计数据更新成功:', data.portfolio.styleStats);
                        }

                        // 按风格重组数据到新的状态对象
                        const newPortfolioHoldings = {
                            quality: [],
                            value: [],
                            growth: [],
                            momentum: []
                        };

                        data.portfolio.stocks.forEach(stock => {
                            const stockData = {
                                ticker: stock.ticker,
                                name: stock.name,
                                shares: stock.shares,
                                cost: stock.buyPrice,  // 注意这里保持与原结构一致使用cost
                                current: stock.finalPrice,
                                market: getMarketCode(stock.ticker)  // 获取市场代码
                            };

                            // 根据风格将股票添加到相应数组
                            if (newPortfolioHoldings.hasOwnProperty(stock.style)) {
                                newPortfolioHoldings[stock.style].push(stockData);
                            }
                        });

                        console.log('持仓数据更新成功:', newPortfolioHoldings);
                        // 更新状态以触发UI刷新
                        setPortfolioHoldings(newPortfolioHoldings);
                    } else {
                        console.error('获取持仓数据失败:', data.error);
                        // 使用默认数据
                        useDefaultData();
                    }
                } catch (error) {
                    console.error('API调用错误:', error);
                    // 使用默认数据
                    useDefaultData();
                }
            }

            // 使用默认数据
            function useDefaultData() {
                console.log('使用默认持仓数据');
                setPortfolioHoldings(JSON.parse(JSON.stringify(defaultPortfolioData)));
            }

            // 获取股票的市场代码
            function getMarketCode(ticker) {
                if (ticker.includes('.HK')) return 'HK';
                if (/^\d{5,6}$/.test(ticker) || ticker.includes('.SS') || ticker.includes('.SZ')) return 'CN';
                return 'US';
            }

            // 组件挂载时获取数据
            useEffect(() => {
                fetchPortfolioData();
            }, []);

            const toggleHoldings = (portfolio) => {
                setExpandedPortfolio(expandedPortfolio === portfolio ? null : portfolio);
            };

            // Initialize Portfolio Chart
            useEffect(() => {
                const ctx = document.getElementById('portfolio-chart');
                if (!ctx) return;

                // 从API获取盈亏历史数据并渲染图表
                const fetchProfitLossHistory = async () => {
                    try {
                        const response = await fetch('https://alphagbm.com/api/profit-loss/history');
                        const data = await response.json();

                        if (data.success) {
                            // 处理API返回的数据
                            const historyData = data.data.items;

                            // 准备图表数据
                            const labels = historyData.map(item => {
                                // 格式化日期，去除时间部分
                                const date = new Date(item.date);
                                return `${date.getMonth() + 1}/${date.getDate()}`;
                            }).reverse(); // 反转数组使其按日期正序排列

                            // 提取各风格的盈亏百分比数据
                            const datasets = [
                                {
                                    label: t.portfolio.quality,
                                    data: historyData.map(item => {
                                        const styleData = item.style_profits?.quality;
                                        return styleData ? styleData.profit_loss_percent : 0;
                                    }).reverse(),
                                    borderColor: '#10B981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: t.portfolio.value,
                                    data: historyData.map(item => {
                                        const styleData = item.style_profits?.value;
                                        return styleData ? styleData.profit_loss_percent : 0;
                                    }).reverse(),
                                    borderColor: '#3B82F6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: t.portfolio.growth,
                                    data: historyData.map(item => {
                                        const styleData = item.style_profits?.growth;
                                        return styleData ? styleData.profit_loss_percent : 0;
                                    }).reverse(),
                                    borderColor: '#A78BFA',
                                    backgroundColor: 'rgba(167, 139, 250, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: t.portfolio.momentum,
                                    data: historyData.map(item => {
                                        const styleData = item.style_profits?.momentum;
                                        return styleData ? styleData.profit_loss_percent : 0;
                                    }).reverse(),
                                    borderColor: '#F59E0B',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                }
                            ];

                            // 创建或更新图表
                            if (window.portfolioChart) {
                                window.portfolioChart.data.labels = labels;
                                window.portfolioChart.data.datasets = datasets;
                                window.portfolioChart.update();
                            } else {
                                window.portfolioChart = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: labels,
                                        datasets: datasets
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: {
                                            legend: {
                                                position: 'top',
                                                labels: {
                                                    color: '#A1A1AA',
                                                    font: { size: 12 },
                                                    padding: 15,
                                                    usePointStyle: true
                                                }
                                            },
                                            tooltip: {
                                                backgroundColor: 'rgba(24, 24, 27, 0.95)',
                                                titleColor: '#FAFAFA',
                                                bodyColor: '#A1A1AA',
                                                borderColor: '#27272A',
                                                borderWidth: 1,
                                                padding: 12,
                                                displayColors: true,
                                                callbacks: {
                                                    label: function (context) {
                                                        const value = context.parsed.y;
                                                        // 根据正负值显示不同的前缀
                                                        return context.dataset.label + ': ' +
                                                            (value >= 0 ? '+' : '') + value.toFixed(2) + '%';
                                                    }
                                                }
                                            }
                                        },
                                        scales: {
                                            x: {
                                                grid: {
                                                    color: 'rgba(39, 39, 42, 0.5)',
                                                    drawBorder: false
                                                },
                                                ticks: {
                                                    color: '#71717A',
                                                    font: { size: 11 }
                                                }
                                            },
                                            y: {
                                                grid: {
                                                    color: 'rgba(39, 39, 42, 0.5)',
                                                    drawBorder: false
                                                },
                                                ticks: {
                                                    color: '#71717A',
                                                    font: { size: 11 },
                                                    callback: function (value) {
                                                        return (value >= 0 ? '+' : '') + value.toFixed(1) + '%';
                                                    }
                                                }
                                            }
                                        },
                                        interaction: {
                                            intersect: false,
                                            mode: 'index'
                                        }
                                    }
                                });
                            }
                        }
                    } catch (error) {
                        console.error('获取盈亏历史数据失败:', error);
                        // 如果API请求失败，可以回退到使用模拟数据
                        useMockData();
                    }
                };

                // 模拟数据生成函数（作为后备方案）
                const useMockData = () => {
                    const days = Array.from({ length: 30 }, (_, i) => {
                        const today = new Date();
                        const date = new Date(today);
                        date.setDate(today.getDate() - (30 - i));
                        return `${date.getMonth() + 1}/${date.getDate()}`;
                    });

                    const generateData = (baseReturn, volatility) => {
                        let cumulative = 0;
                        return Array.from({ length: 30 }, () => {
                            cumulative += (Math.random() - 0.5) * volatility + baseReturn / 30;
                            return cumulative;
                        });
                    };

                    if (window.portfolioChart) {
                        window.portfolioChart.destroy();
                    }

                    window.portfolioChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: days,
                            datasets: [
                                {
                                    label: t.portfolio.quality,
                                    data: generateData(12.5, 1.5),
                                    borderColor: '#10B981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: t.portfolio.value,
                                    data: generateData(8.3, 1.2),
                                    borderColor: '#3B82F6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: t.portfolio.growth,
                                    data: generateData(15.7, 2.0),
                                    borderColor: '#A78BFA',
                                    backgroundColor: 'rgba(167, 139, 250, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: t.portfolio.momentum,
                                    data: generateData(6.2, 2.5),
                                    borderColor: '#F59E0B',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: t.portfolio.sp500,
                                    data: generateData(9.0, 1.0),
                                    borderColor: '#6B7280',
                                    backgroundColor: 'rgba(107, 116, 128, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                },
                                {
                                    label: t.portfolio.nasdaq,
                                    data: generateData(11.0, 1.3),
                                    borderColor: '#0D9B97',
                                    backgroundColor: 'rgba(13, 155, 151, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                },
                                {
                                    label: t.portfolio.hsi,
                                    data: generateData(7.5, 1.8),
                                    borderColor: '#EF4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                },
                                {
                                    label: t.portfolio.csi300,
                                    data: generateData(5.8, 1.5),
                                    borderColor: '#F97316',
                                    backgroundColor: 'rgba(249, 115, 22, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: '#A1A1AA',
                                        font: { size: 12 },
                                        padding: 15,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(24, 24, 27, 0.95)',
                                    titleColor: '#FAFAFA',
                                    bodyColor: '#A1A1AA',
                                    borderColor: '#27272A',
                                    borderWidth: 1,
                                    padding: 12,
                                    displayColors: true,
                                    callbacks: {
                                        label: function (context) {
                                            return context.dataset.label + ': +' + context.parsed.y.toFixed(2) + '%';
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    grid: {
                                        color: 'rgba(39, 39, 42, 0.5)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        color: '#71717A',
                                        font: { size: 11 }
                                    }
                                },
                                y: {
                                    grid: {
                                        color: 'rgba(39, 39, 42, 0.5)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        color: '#71717A',
                                        font: { size: 11 },
                                        callback: function (value) {
                                            return value.toFixed(1) + '%';
                                        }
                                    }
                                }
                            },
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            }
                        }
                    });
                };

                // 初始化图表，优先使用API数据
                fetchProfitLossHistory();

                return () => {
                    if (window.portfolioChart) {
                        window.portfolioChart.destroy();
                    }
                };
            }, [t]);

            return (
                <div className="min-h-screen relative overflow-hidden">
                    {/* Background Grid */}
                    <div className="absolute inset-0 z-[-1]" style={{
                        backgroundImage: 'linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px)',
                        backgroundSize: '40px 40px'
                    }}></div>

                    {/* Hero Glow */}
                    <div className="hero-glow"></div>

                    {/* Navbar */}
                    <nav className="fixed w-full z-50 bg-slate-950/80 backdrop-blur-md border-b border-slate-800">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex items-center justify-between h-16">
                                <div className="flex items-center gap-2">
                                    <span className="font-bold text-xl tracking-tight">Alpha<span style={{ color: '#0D9B97' }}>GBM</span></span>
                                </div>
                                <div className="hidden md:block">
                                    <div className="ml-10 flex items-baseline space-x-8">
                                        <a href="#" className="hover:text-brand transition-colors text-sm">{t.nav.home}</a>
                                        <a href="#portfolio" className="hover:text-brand transition-colors text-sm">{t.nav.portfolio}</a>
                                        <a href="#styles" className="hover:text-brand transition-colors text-sm">{t.nav.styles}</a>
                                        <a href="#contact" className="hover:text-brand transition-colors text-sm">{t.nav.download}</a>
                                    </div>
                                </div>
                                <div className="flex items-center gap-4">
                                    <button onClick={toggleLang} className="text-sm font-mono border border-slate-700 px-3 py-1 rounded hover:bg-slate-800 transition-colors">
                                        {t.nav.lang}
                                    </button>
                                    <a href="http://localhost:5002" className="bg-brand text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-opacity-90 transition-colors shadow-brand">
                                        {t.nav.cta}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Hero Section */}
                    <main className="pt-32 pb-16 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">

                        <div className="text-center">
                            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800/50 border border-slate-700 text-brand text-xs font-medium mb-6">
                                <i className="ph ph-sparkle-fill"></i>
                                {t.hero.badge}
                            </div>
                            <h1 className="text-5xl md:text-7xl font-extrabold tracking-tight mb-6">
                                {t.hero.title} <br className="hidden md:block" />
                                <span className="gradient-text">{t.hero.titleHighlight}</span>
                            </h1>
                            <p className="mt-4 max-w-2xl mx-auto text-xl text-slate-400">
                                {t.hero.subtitle}
                            </p>

                            {/* G=B+M Model Formula */}
                            <div className="mt-8 flex items-center justify-center gap-3 text-lg font-mono">
                                <span className="font-bold" style={{ color: '#0D9B97' }}>{lang === 'en' ? 'G (Gain)' : 'G（收益）'}</span>
                                <span className="text-slate-500">=</span>
                                <span className="font-bold text-emerald-400">{lang === 'en' ? 'B (Basics)' : 'B（基本面）'}</span>
                                <span className="text-slate-500">+</span>
                                <span className="font-bold" style={{ color: '#F59E0B' }}>{lang === 'en' ? 'M (Momentum)' : 'M（动量）'}</span>
                            </div>

                            {/* CTA Area */}
                            <div className="mt-10 flex flex-col items-center">
                                <a href="http://localhost:5002" className="beta-pulse px-8 py-3 rounded-lg bg-brand text-white font-bold hover:bg-brand transition-all shadow-brand">
                                    {t.hero.cta_primary}
                                </a>
                                <div className="mt-4 text-xs text-slate-400 bg-slate-800/50 px-4 py-2 rounded-full border border-slate-700">
                                    {t.hero.limit_notice}
                                </div>
                            </div>

                            {/* Portfolio Section - Four Style Portfolios */}
                            <section id="portfolio" className="my-20">
                                <div className="text-center mb-12">
                                    <h2 className="text-3xl font-bold mb-4">{t.portfolio.title}</h2>
                                    <p className="text-slate-400 max-w-2xl mx-auto">{t.portfolio.description}</p>
                                </div>

                                {/* Performance Chart */}
                                <div className="glass-card rounded-2xl p-6 mb-8">
                                    <h3 className="text-xl font-bold mb-6 flex items-center gap-2">
                                        <i className="ph ph-chart-line-up"></i>
                                        {t.portfolio.performanceChart}
                                    </h3>
                                    <div className="w-full h-[400px]">
                                        <canvas id="portfolio-chart"></canvas>
                                    </div>
                                </div>

                                {/* Portfolio Summary Cards with Holdings Detail */}
                                <div className="space-y-6 mb-8">
                                    {/* 定义投资风格配置 */}
                                    {[
                                        { key: 'quality', name: t.portfolio.quality, color: 'emerald' },
                                        { key: 'value', name: t.portfolio.value, color: 'blue' },
                                        { key: 'growth', name: t.portfolio.growth, color: 'purple' },
                                        { key: 'momentum', name: t.portfolio.momentum, color: 'orange' }
                                    ].map((config, idx) => {
                                        // 获取该风格的统计数据
                                        const stats = styleStats[config.key] || { profitLossPercent: '0', vsYesterdayPercent: '0' };

                                        // 获取盈亏数据并格式化
                                        const profitLossPercent = parseFloat(stats.profitLossPercent) || 0;
                                        const vsYesterdayPercent = parseFloat(stats.vsYesterdayPercent) || 0;

                                        // 判断相对昨日变化是否为正数
                                        const dailyPositive = vsYesterdayPercent >= 0;

                                        // 格式化显示的百分比
                                        const formattedProfitLoss = profitLossPercent >= 0 ? `+${profitLossPercent}%` : `${profitLossPercent}%`;
                                        const formattedVsYesterday = vsYesterdayPercent >= 0 ? `+${vsYesterdayPercent.toFixed(2)}%` : `${vsYesterdayPercent.toFixed(2)}%`;

                                        return (
                                            <div key={idx} className="glass-card rounded-2xl p-6">
                                                <div className="flex items-center justify-between mb-4">
                                                    <div className="flex items-center gap-4">
                                                        <div className={`w-1 h-12 rounded-full bg-${config.color}-500`}></div>
                                                        <div>
                                                            <div className={`text-${config.color}-400 font-semibold text-lg`}>{config.name}</div>
                                                            <div className="text-xs text-slate-400">{t.portfolio.initialCapital}: $250K</div>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-6">
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-white">{formattedProfitLoss}</div>
                                                            <div className={`text-sm ${dailyPositive ? 'text-emerald-400' : 'text-red-400'}`}>
                                                                {t.portfolio.dailyChange}: {formattedVsYesterday}
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={() => toggleHoldings(config.key)}
                                                            className="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white text-sm transition-colors">
                                                            {expandedPortfolio === config.key ? t.portfolio.hideHoldings : t.portfolio.viewHoldings}
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* Holdings Detail Table */}
                                                {expandedPortfolio === config.key && (
                                                    <div className="mt-4 overflow-x-auto">
                                                        <table className="w-full text-sm">
                                                            <thead>
                                                                <tr className="border-b border-slate-700">
                                                                    <th className="text-left py-3 px-2 text-slate-400 font-medium">{t.portfolio.stock}</th>
                                                                    <th className="text-right py-3 px-2 text-slate-400 font-medium">{t.portfolio.shares}</th>
                                                                    <th className="text-right py-3 px-2 text-slate-400 font-medium">{t.portfolio.costPrice}</th>
                                                                    <th className="text-right py-3 px-2 text-slate-400 font-medium">{t.portfolio.currentPrice}</th>
                                                                    <th className="text-right py-3 px-2 text-slate-400 font-medium">{t.portfolio.allocation}</th>
                                                                    <th className="text-right py-3 px-2 text-slate-400 font-medium">{t.portfolio.profitPercent}</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {portfolioHoldings[config.key].map((holding, hidx) => {
                                                                    const profit = ((holding.current - holding.cost) / holding.cost * 100).toFixed(2);
                                                                    const marketValue = holding.shares * holding.current;

                                                                    // 定义汇率（可根据实际情况更新）
                                                                    const exchangeRates = {
                                                                        'US': 1,       // 美元
                                                                        'HK': 0.128,   // 港币兑美元
                                                                        'CN': 0.139    // 人民币兑美元
                                                                    };

                                                                    // 根据市场获取当前持仓的美元价值
                                                                    const currentMarket = holding.market || 'US';
                                                                    const rate = exchangeRates[currentMarket] || 1;
                                                                    const marketValueInUSD = marketValue * rate;

                                                                    // 计算整个投资组合的美元总价值
                                                                    const totalValueInUSD = portfolioHoldings[config.key].reduce((sum, h) => {
                                                                        const hMarket = h.market || 'US';
                                                                        const hRate = exchangeRates[hMarket] || 1;
                                                                        return sum + (h.shares * h.current * hRate);
                                                                    }, 0);

                                                                    // 计算美元计价后的配置比例
                                                                    const allocation = ((marketValueInUSD / totalValueInUSD) * 100).toFixed(1);

                                                                    // 根据市场获取货币符号
                                                                    const getCurrencySymbol = (market) => {
                                                                        switch (market) {
                                                                            case 'HK': return 'HK$';
                                                                            case 'CN': return '¥';
                                                                            default: return '$';
                                                                        }
                                                                    };

                                                                    return (
                                                                        <tr key={hidx} className="border-b border-slate-800 last:border-b-0">
                                                                            <td className="py-3 px-2">
                                                                                <div className="font-medium text-white">{holding.name}</div>
                                                                                <div className="text-slate-400 text-xs">{holding.ticker}</div>
                                                                                <div className="text-slate-500 text-xs mt-1">{holding.market === 'US' ? 'US' : holding.market === 'HK' ? 'HK' : 'CN'}</div>
                                                                            </td>
                                                                            <td className="py-3 px-2 text-right text-white">{holding.shares.toLocaleString()}</td>
                                                                            <td className="py-3 px-2 text-right text-white">{getCurrencySymbol(holding.market)}{holding.cost.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                                                                            <td className="py-3 px-2 text-right text-white">{getCurrencySymbol(holding.market)}{holding.current.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                                                                            <td className="py-3 px-2 text-right text-white">{allocation}%</td>
                                                                            <td className={`py-3 px-2 text-right font-medium ${parseFloat(profit) >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                                                                                {parseFloat(profit) >= 0 ? '+' : ''}{profit}%
                                                                            </td>
                                                                        </tr>
                                                                    );
                                                                })}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </section>
                        </div>
                    </main>

                    {/* Styles Section */}
                    <section id="styles" className="py-20 bg-slate-900/30">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="text-center mb-16">
                                <h2 className="text-3xl font-bold tracking-tight sm:text-4xl mb-4">{t.styles.title}</h2>
                                <p className="text-slate-400">{t.styles.desc}</p>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                {t.styles.cards.map((style, index) => (
                                    <div key={index} className="glass-card p-6 rounded-xl relative overflow-hidden group">
                                        <div className={`absolute top-0 left-0 w-1 h-full ${style.color.replace('text', 'bg')}`}></div>
                                        <h3 className={`text-xl font-bold mb-2 ${style.color}`}>{style.name}</h3>
                                        <p className="text-slate-400 text-sm leading-relaxed">
                                            {style.desc}
                                        </p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* Hidden Stock Chart Section */}
                    <section id="stock-chart" className="hidden py-20 bg-slate-900/30">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="text-center mb-16">
                                <h2 className="text-3xl font-bold tracking-tight sm:text-4xl mb-4">Apple 股价分析</h2>
                                <p className="text-slate-400">实时股价数据与AI买入点分析</p>
                            </div>

                            <div className="glass-card rounded-2xl p-6 md:p-8">
                                <div id="chart-container" className="w-full h-[400px] mb-6">
                                    <canvas id="stock-chart"></canvas>
                                </div>
                                <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                    <div className="text-center md:text-left">
                                        <div className="text-sm text-slate-400">当前价格</div>
                                        <div className="text-3xl font-bold text-brand">${currentPrice}</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-sm text-slate-400">最高买入收益率</div>
                                        <div className="text-3xl font-bold text-green-400">{maxReturn}</div>
                                    </div>
                                    <div className="text-center md:text-right">
                                        <div className="text-sm text-slate-400">AI推荐仓位</div>
                                        <div className="text-3xl font-bold text-purple-400">{aiPosition}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Features Section */}
                    <section id="features" className="py-20">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="text-center mb-16">
                                <h2 className="text-3xl font-bold tracking-tight sm:text-4xl mb-4">{t.features.title}</h2>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {t.features.items.map((feature, idx) => (
                                    <div key={idx} className="flex gap-4 p-6 glass-card rounded-xl">
                                        <div className="flex-shrink-0">
                                            <i className={`ph ph-${feature.icon.toLowerCase().replace('warning', '-warning').replace('up', '-up').replace('west', '-west').replace('pie', '-pie')} text-3xl text-brand`}></i>
                                        </div>
                                        <div>
                                            <h3 className="text-lg font-semibold text-white mb-2">{feature.title}</h3>
                                            <p className="text-slate-400 text-sm leading-relaxed">{feature.desc}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* QR Code / Contact Section */}
                    <section id="contact" className="py-20 relative overflow-hidden">
                        {/* Background glow for this section */}
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-brand/10 blur-[100px] rounded-full pointer-events-none"></div>

                        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                            <div className="glass-card rounded-2xl p-8 md:p-12 text-center border border-slate-700/50 shadow-2xl">
                                <h2 className="text-3xl font-bold mb-4">{t.cta.title}</h2>
                                <p className="text-slate-400 mb-8 max-w-xl mx-auto">{t.cta.desc}</p>

                                <div className="flex flex-col items-center justify-center">
                                    <div className="relative group cursor-pointer">
                                        {/* QR Code Placeholder Box */}
                                        <div className="w-48 h-48 bg-white rounded-xl flex items-center justify-center overflow-hidden border-4 border-white shadow-lg relative">
                                            {/* Replace the src below with your actual QR Code image */}
                                            <img
                                                src="./WeChat-QR-Code.jpg"
                                                alt="WeChat QR Code"
                                                className="w-full h-full object-cover"
                                            />

                                        </div>
                                        <div className="mt-4 flex items-center justify-center gap-2 text-brand font-semibold text-sm">
                                            <i className="ph ph-qr-code"></i>
                                            {t.cta.scan_text}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Footer */}
                    <footer className="border-t border-slate-800 bg-slate-950 py-12">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                            <div className="flex items-center justify-center gap-2 mb-8">
                                <span className="font-bold text-xl tracking-tight">Alpha<span style={{ color: '#0D9B97' }}>GBM</span></span>
                            </div>
                            <p className="text-slate-600 text-xs max-w-2xl mx-auto mb-4">
                                {t.footer.disclaimer}
                            </p>
                            <p className="text-slate-700 text-sm">
                                {t.footer.copy}
                            </p>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>